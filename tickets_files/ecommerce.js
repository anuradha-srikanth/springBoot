function updateSearch(){var r,t,n,i,u;if($gh(".ff-search").validate(),$gh("#totalPassengers").prop("readonly",!1),$gh(".ff-search").attr("data-submitted","true"),r=$gh(".ff-search").valid(),r){window.ff_error=!1;t=Helpers.ParseForm("schedule-fare-search");n=SearchRepo.GetCurrent();t.departOn=$("#datepicker-from").datepicker("getDate");t.returnOn?t.returnOn=$("#datepicker-to").datepicker("getDate"):delete n.returnOn;for(i in t)t.hasOwnProperty(i)&&(n[i]!=t[i]&&typeof pageTracker!=typeof undefined&&pageTracker!=undefined&&pageTracker._trackEvent("EditYourTrip","Trip Fields Updated",i),n[i]=t[i]);t.wheelchairs||delete n.wheelchairs;u=parseInt(n.adults)+parseInt(n.seniors)-parseInt(n.children);u<=1&&n.discountType!==undefined&&(n.discountType.toLowerCase()==="companion"||n.discountType.toLowerCase()==="roadrewards"&&n.discountCode.indexOf("TCP")>-1)&&(n.discountCode="",n.discountType="coupon",n.DiscountCompanionRemoved="true");SearchRepo.Save(n);typeof pageTracker!=typeof undefined&&pageTracker!=undefined&&pageTracker._trackEvent("EditYourTrip","Edit Trip Submitted.");location.reload()}else return window.ff_error=!0,!1}function preventTimeTravel(n,t){t==="Return"&&n.returnOn?moment(n.returnOn).isBefore(n.departOn)&&(n.returnOn=n.departOn):n.returnOn&&moment(n.departOn).isAfter(n.returnOn)&&(n.departOn=n.returnOn)}function selectNewDate(n,t){var r,i=moment(n),u;t==="outgoing"?(pageGlobal.fareObj.departOn=i,preventTimeTravel(pageGlobal.fareObj,"Return"),pageGlobal.scheduleSelection&&pageGlobal.scheduleSelection.OutgoingScheduleKey&&(pageGlobal.scheduleSelection.OutgoingScheduleKey=null),r="#outgoing-trip"):(pageGlobal.fareObj.returnOn=i,r="#return-trip");$gh("#datepicker-from").datepicker("setDate",moment(pageGlobal.fareObj.departOn).format("MM/DD/YYYY"));pageGlobal.fareObj.returnOn&&$gh("#datepicker-to").datepicker("setDate",moment(pageGlobal.fareObj.returnOn).format("MM/DD/YYYY"));$gh("#travel-depart-summary").text(moment(pageGlobal.fareObj.departOn).format("MMM D YYYY"));$gh("#travel-return-summary").text(moment(pageGlobal.fareObj.returnOn).format("MMM D YYYY"));SearchRepo.Save(pageGlobal.fareObj);$gh(".schedule-selector").css("visibility","hidden");$gh(".schedule-calendar").css("visibility","hidden");$gh(".loader-overlay").show();$(".filter-alert").addClass("hidden");u=new ScheduleCalendar($,Ghound);u.init(ResponsiveBootstrapToolkit,$(r+" .schedule-calendar-wrapper"),i.toDate());Accessibility.announceStatusUpdate(SchedulesUpdatedForDateSelectedAccessibility+moment(i).format("MMM D YYYY"))}function displayNoSchedulesMessage(n,t,i){n.find(".fare-rows").html($gh("#empty-schedules").html()).addClass("empty-schedules");i?n.find("#empty-schedule-filter").removeClass("hidden"):n.find("#empty-calendar-message").removeClass("hidden");displayFilterAndSortButtons(n,t);$gh(".loader-overlay").fadeOut("300",function(){$gh(".schedule-selector").css("visibility","visible");n.removeClass("ghidden");calendarInit()})}function displayFilterAndSortButtons(n,t){t?n.find(".filtering-sorting").removeClass("ghidden"):n.find(".filtering-sorting").addClass("ghidden")}function calendarInit(){var n=new ScheduleCalendar($,Ghound);n.doMobileCarousel($(".schedule-calendar"))}function AugmentStopData(n){var r={},u,i,t;for(r.showOtherBusLines=!1,r.Stops=[],u=0,i=0;i<n.Stops.length;i++)t=n.Stops[i],t.IsPartnerCarrier=Boolean(ConfigurationSettings.GreyhoundBusLineCodes.indexOf(t.Carrier)<0),t.StationLocation&&t.StationLocation.StationLocationUrl!=null&&(t.ShowStationLocationUrl=!0),(t.IsTransfer||i===0||i===n.Stops.length-1)&&t.IsTransfer&&(u%2==0?t.IsFirstTransfer=!0:t.IsSecondTransfer=!0,u++),t.IsPartnerCarrier&&(r.showOtherBusLines=!0),r.Stops.push(t);return r}function GenerateStopsKey(n){for(var t,u=function(n,t,i){for(var r=0,u=n.length;r<u;r++)if(n[r][i]===t)return r;return-1},i={NonGhCarriers:[],HasCurbside:!1,HasPartnerStation:!1,HasGhStation:!1,HasExpress:!1},r=0;r<n.length;r++)t=n[r],ConfigurationSettings.GreyhoundBusLineCodes.indexOf(t.Carrier)<0&&u(i.NonGhCarriers,t.Carrier,"Code")<0&&i.NonGhCarriers.push({Code:t.Carrier,Name:t.CarrierName}),t.IsExpress&&(i.HasExpress=!0),t.StopType==="Curbside"&&(i.HasCurbside=!0),t.StopType==="PartnerStation"&&(i.HasPartnerStation=!0),t.StopType==="GreyhoundStation"&&(i.HasGhStation=!0);return i}function stickyFareThead(n){(function(t,i){function r(){t(document).scrollTop()>n+t(".sticky-schedule-selector").outerHeight()&&(i.is("xs")||i.is("sm"))&&(t("body").addClass("sticky-thead-on"),t(".sticky-thead-on .sticky-head").css("top",t(".sticky-schedule-selector").outerHeight()),t(".sticky-thead-on .old-schedule-table.sticky-head").bind("click",function(){Ghound.ScrollToTopOfPage($gh(".summary-bar"));ScheduleSummaryBar.showSummaryBar()}));t(document).scrollTop()<n&&(i.is("xs")||i.is("sm"))&&t("body").removeClass("sticky-thead-on")}r();t(window).scroll(function(){r()})})(jQuery,ResponsiveBootstrapToolkit)}function displaySchedule(n,t,i){var s,h,u,f,r,e,o;$gh(".schedule-selector").css("visibility","hidden");$gh(".schedule-calendar").css("visibility","hidden");$gh(".loader-overlay").show();$(".filter-alert").addClass("hidden");s=function(n){n<ConfigurationSettings.PaymentPageMinTime&&SessionTracker.RedirectToTimeout()};n=checkForSoldAndCutoff(n);pageGlobal.currentSchedule||(pageGlobal.currentSchedule={});t==="outgoing"?(pageGlobal.currentSchedule.DepartureResponse=n,SessionTracker.SetStart(n._cachedTime),SessionTracker.StartTracking(s)):pageGlobal.currentSchedule.ReturnResponse=n;h=function(n){n.forEach(function(n){var i=[{FareType:"Economy",Fare:n.OnlineFares.Economy,Details:fareTypes.Economy},{FareType:"EconomyExtra",Fare:n.OnlineFares.EconomyExtra,Details:fareTypes.EconomyExtra},{FareType:"Flexible",Fare:n.OnlineFares.Flexible,Details:fareTypes.Flexible}],r,t;n.OnlineFareDisplay=i;n.DefaultFare=_.find(i,function(n){return Boolean(n.Fare)});r=[{Fare:n.OfflineFares.Economy,Details:fareTypes.OfflineEconomy},{Fare:n.OfflineFares.EconomyExtra,Details:fareTypes.OfflineEconomyExtra},{Fare:n.OfflineFares.Flexible,Details:fareTypes.OfflineFlexible}];n.OfflineFareDisplay=r;t=SearchRepo.GetCurrent();seatNudgeSettings.ShowSeatsRemaining&&parseInt(n.SeatsAvailable)<=parseInt(seatNudgeSettings.AvailableSeatsThreshold)&&parseInt(n.SeatsAvailable)>0?(n.displaySeatRemaining=!0,t.ViewedSeatNudge="true",$gh.ajax({type:"GET",url:"/analytics/TriggerGoal/"+seatNudgeSettings.ViewedSeatNudgeGoal})):n.displaySeatRemaining=!1;SearchRepo.Save(t)})};u=moment(i).format("MMMM Do YYYY");h(n.Schedules);f={IsRoundTrip:n.IsRoundTrip,SchedulesGroup:n.Schedules,PreventOnlineSales:t==="outgoing"&&n.IsAgencyWillCallAvailable===!1};$("body").removeClass("fares-open");t==="outgoing"?(r=new ScheduleRow(jQuery,Ghound,StaticMap),r.init(f,$gh("#outgoing-trip")),$gh("#outgoing-selected-date").length>0&&$gh("#outgoing-selected-date").text(u),$gh("#soldout-outgoing-selected-date").length>0&&$gh("#soldout-outgoing-selected-date").text(moment(i).format("MMMM Do")),stickyFareThead($("#outgoing-trip .fare-rows").offset().top)):(r=new ScheduleRow(jQuery,Ghound,StaticMap),e=$gh("#return-trip"),r.init(f,e),e.find("td.fare-type").not("[data-fare-type-heading='"+pageGlobal.scheduleSelection.OutgoingFareType+"']").addClass("opacity"),$gh("#return-selected-date").length>0&&$gh("#return-selected-date").text(u),$gh("#soldout-return-selected-date").length>0&&$gh("#soldout-return-selected-date").text(moment(i).format("MMMM Do")),$gh("#return-trip").removeClass("ghidden"),Ghound.scrollToReveal($("#return-date-header"),240),stickyFareThead($("#return-trip .fare-rows").offset().top));o=function(n){$gh(n).each(function(){var r=$gh(this).find(".eticket-only-notification:visible"),n=$gh(this).find(".desktop-fare-eticket-only"),f=$gh(r).outerHeight(),t,u,i;n&&(u=n.height(),t=n.find(".fake-radio-btn").css("top"));t&&(i=t.replace(/[^-\d\.]/g,""));n&&i&&(n.css("height",u+$gh(r).outerHeight()),n.find(".fake-radio-btn").css("top",parseInt(i)+f/2.5+"px"))})};t==="outgoing"?o("#outgoing-trip .fare-rows"):o("#return-trip .fare-rows");$gh(".loader-overlay").fadeOut("300",function(){$gh(".schedule-selector").css("visibility","visible");calendarInit()});$gh(".filter-results-btn").each(function(){$(this).hasClass("filter-default")?$(this).addClass("active"):$(this).removeClass("active")})}function getSchedules(n,t,i,r,u){var f=["Economy","EconomyExtra","Flexible"],e=SearchRepo.GetCurrent();e.ViewedSeatNudge="false";SearchRepo.Save(e);var s=function(n){var t=function(n){for(var t,i,r,e,o,u=0;u<n.length;u++)for(t=n[u],i=0;i<f.length-1;i++)for(r=i+1;r<f.length;r++)t.OnlineFares[f[i]]&&(e=t.OnlineFares[f[i]],t.OnlineFares[f[r]]&&(o=t.OnlineFares[f[r]],e.FareAverage>=o.FareAverage&&delete t.OnlineFares[f[r]]))};t(n.Schedules)},h=function(n){var t=function(n){for(var t,i,r,e=function(n){for(var t,i=null,r=null,u=0;u<f.length;u++)n[f[u]]&&(t=n[f[u]],t.FareTotal!==undefined&&(!i||i>t.FareTotal)&&(i=t.FareTotal),t.FareAverage!==undefined&&(!r||r>t.FareAverage)&&(r=t.FareAverage));i!==null&&(n.LowestFare=i);r!==null&&(n.LowestFareAverage=r)},u=0;u<n.length;u++)t=n[u],e(t.OnlineFares),e(t.OfflineFares),i=null,r=null,t.OnlineFares.LowestFare!==undefined&&(i=t.OnlineFares.LowestFare),t.OfflineFares.LowestFare!==undefined&&(!i||t.OfflineFares.LowestFare<i)&&(i=t.OfflineFares.LowestFare),t.OnlineFares.LowestFareAverage!==undefined&&(r=t.OnlineFares.LowestFareAverage),t.OfflineFares.LowestFareAverage!==undefined&&(!r||t.OfflineFares.LowestFareAverage<r)&&(r=t.OfflineFares.LowestFareAverage),i!==null&&(t.LowestFare=i),r!==null&&(t.LowestFareAverage=r)};t(n.Schedules)},o=function(n){s(n);h(n);i(n)};u?SchedulesRepo.GetSchedules(o,r,n,t,!0):SchedulesRepo.GetReturnSchedules(o,r,n,!0)}function getSchedulesForDeparture(n,t,i,r){var u=SearchRepo.GetCurrent();u.departOn=n;preventTimeTravel(u,"Return");getSchedules(u,t,i,r,!0)}function getSchedulesForReturn(n,t,i,r){var u=function(n){var t=getScheduleByKey(pageGlobal.currentSchedule.DepartureResponse.Schedules,pageGlobal.scheduleSelection.OutgoingScheduleKey);n.OutgoingArrivalTime=moment(t.ArrivalDateTime);i(n)},f=getScheduleByKey(pageGlobal.currentSchedule.DepartureResponse.Schedules,pageGlobal.scheduleSelection.OutgoingScheduleKey),e={requestId:pageGlobal.currentSchedule.DepartureResponse.RequestId,fareKey:f.OnlineFares[pageGlobal.scheduleSelection.OutgoingFareType].FareKey,returnDate:n,webOnly:t};getSchedules(e,null,u,r,!1)}function getScheduleByKey(n,t){var i=_.filter(n,function(n){return n.ScheduleKey===t});return _.first(i)}function checkForSoldAndCutoff(n){var t=[];return n.Schedules.forEach(function(n){n.IsPastETicketCutoffTime?n.MinutesBeforeDeparture>0&&t.push(n):t.push(n)}),n.Schedules=t,n}function ConfirmationPage(){function t(){function i(n){var i=function(n,i,r){var f=i.parents(".resend-ticket").find(".submit-response"),u=i.parents(".resend-ticket").find(".submit-error"),e=function(){f.removeClass("hidden").find(".alert").html(r.attr("data-msg-success")+" "+r.val());r.val("");i.removeAttr("disabled")},o=function(n){u.text(n.Code+": "+n.Message);u.removeClass("hidden");i.removeAttr("disabled")};i.click(function(){if(f.addClass("hidden"),u.addClass("hidden"),r.rules("add",{required:!0}),n.valid()){i.attr("disabled","true");var s=ApiClientFactory.GetClient("itinerary/"+t.confirmationnumber+"/email");s.GetData({lastName:t.lastname,toAddress:r.val()},e,o)}else r.focus();return r.rules("remove","required"),!1})},r=Helpers.GetQueryString(),f,e;n.IsFromMyTrips=!1;r.leg&&(r.leg=="1"||r.leg=="2")&&(n.IsFromMyTrips=!0);n.TicketingMethod==="PrintAtHome"?($("#mobile-ticket-willcall").detach(),$("#desktop-ticket-willcall").detach(),Helpers.BindAndShow("print-your-ticket",n,"print-your-ticket-template"),Helpers.BindAndShow("email-your-confirmation",n),n.ETicketEligible?(Helpers.BindAndShow("mobile-ticket-pah",n,"mobile-ticket-pah-template"),Helpers.BindAndShow("desktop-ticket-pah",n,"desktop-ticket-pah-template"),$("#mobile-ticket-generic").detach(),$("#mobile-ticket-view").detach(),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-hours-before-departure").detach(),$("#desktop-ticket-generic").detach(),$gh("#email-your-confirmation .resend-ticket").validate(),i($gh("#email-your-confirmation .resend-ticket"),$gh("#btnResendEmail2"),$gh("#resend-email2"))):($("#mobile-ticket-pah").detach(),$("#desktop-ticket-pah").detach(),$("#mobile-ticket-generic").detach(),$("#mobile-ticket-view").detach(),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-hours-before-departure").detach(),$gh("#print-your-ticket .resend-ticket").validate(),i($gh("#print-your-ticket .resend-ticket"),$gh("#btnResendEmail"),$gh("#resend-email")))):n.TicketingMethod==="ETicket"?n.ETicketEligible?($("#desktop-ticket-pah").detach(),Helpers.BindAndShow("print-your-ticket",n,"print-your-ticket-template"),$("#print-your-ticket").detach(),$("#mobile-ticket-pah").detach(),Helpers.BindAndShow("desktop-ticket-generic",n,"desktop-ticket-generic-template"),n.ShowDefaultConfirmation?(Helpers.BindAndShow("mobile-ticket-generic",n,"mobile-ticket-generic-template"),$("#mobile-ticket-view").detach(),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-hours-before-departure").detach()):n.CheckedIn?(Helpers.BindAndShow("mobile-ticket-view",n,"mobile-ticket-view-template"),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-hours-before-departure").detach(),$("#mobile-ticket-generic").detach()):n.CanCheckIn?(Helpers.BindAndShow("mobile-ticket-checkin",n,"mobile-ticket-checkin-template"),$("#mobile-ticket-hours-before-departure").detach(),$("#mobile-ticket-view").detach(),$("#mobile-ticket-generic").detach()):(Helpers.BindAndShow("mobile-ticket-hours-before-departure",n,"mobile-ticket-hours-before-departure-template"),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-view").detach(),$("#mobile-ticket-generic").detach()),Helpers.BindAndShow("email-your-confirmation",n),$gh("#email-your-confirmation .resend-ticket").validate(),i($gh("#email-your-confirmation .resend-ticket"),$gh("#btnResendEmail2"),$gh("#resend-email2"))):(Helpers.BindAndShow("print-your-ticket",n,"print-your-ticket-template"),Helpers.BindAndShow("email-your-confirmation",n),$("#mobile-ticket-pah").detach(),$("#desktop-ticket-pah").detach(),$("#mobile-ticket-generic").detach(),$("#mobile-ticket-view").detach(),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-hours-before-departure").detach(),$gh("#print-your-ticket .resend-ticket").validate(),i($gh("#print-your-ticket .resend-ticket"),$gh("#btnResendEmail"),$gh("#resend-email"))):n.TicketingMethod==="WillCall"?n.ETicketEligible?($("#mobile-ticket-pah").detach(),$("#desktop-ticket-pah").detach(),$("#mobile-ticket-generic").detach(),$("#mobile-ticket-view").detach(),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-hours-before-departure").detach(),$("#desktop-ticket-generic").detach(),n.StationLocationUrl=n.DepartureSchedule.Stops[0].StationLocation.StationLocationUrl,Helpers.BindAndShow("desktop-ticket-willcall",n,"desktop-ticket-willcall-template"),Helpers.BindAndShow("mobile-ticket-willcall",n,"mobile-ticket-willcall-template"),Helpers.BindAndShow("email-your-confirmation",n),$gh("#email-your-confirmation .resend-ticket").validate(),i($gh("#email-your-confirmation .resend-ticket"),$gh("#btnResendEmail2"),$gh("#resend-email2"))):($("#mobile-ticket-pah").detach(),$("#desktop-ticket-pah").detach(),$("#mobile-ticket-generic").detach(),$("#mobile-ticket-view").detach(),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-hours-before-departure").detach(),$("#desktop-ticket-generic").detach(),$("#mobile-ticket-willcall").detach(),$("#desktop-ticket-willcall").detach(),n.isEconomyExtra=!1,n.isFlexible=!1,n.DepartureSchedule.FareType=="EconomyExtra"?n.isEconomyExtra=!0:n.DepartureSchedule.FareType=="Flexible"&&(n.isFlexible=!0),n.ShowVouchers=n.DepartureSchedule.FareType!=="Economy"||n.ReturnSchedule&&n.ReturnSchedule.FareType!=="Economy",Helpers.BindAndShow("email-your-confirmation",n),Helpers.BindAndShow("collect-your-ticket",n),$gh("#collect-your-ticket .resend-ticket").validate(),i($gh("#collect-your-ticket .resend-ticket"),$gh("#btnWillCallResendEmail"),$gh("#willcall-resend-email"))):n.PaymentType==="Cash"&&($("#mobile-ticket-pah").detach(),$("#desktop-ticket-pah").detach(),$("#mobile-ticket-generic").detach(),$("#mobile-ticket-view").detach(),$("#mobile-ticket-checkin").detach(),$("#mobile-ticket-hours-before-departure").detach(),$("#desktop-ticket-generic").detach(),$("#mobile-ticket-willcall").detach(),$("#desktop-ticket-willcall").detach(),f=moment(n.ReleaseLocalDateTime),n.UntilTime=f.format("LT"),n.UntilDate=f.format("L"),n.ETicketEligible=!1,Helpers.BindAndShow("reserve-ticket",n,"reserve-ticket-template"),Helpers.BindAndShow("email-your-confirmation",n));$(".eticketmodal").on("click",function(){u()});Cookies.getJSON("confirmedTransaction")&&(e=Cookies.getJSON("confirmedTransaction"),dataLayer.push(e),dataLayer.push({event:"transactionComplete"}),Cookies.remove("confirmedTransaction"))}function r(n){var t;n.FareTotal=parseFloat(n.FareTotal).toFixed(2);n.IsBooked=n.PaymentStatus==="Paid";n.OutgoingFareTypeDetails=fareTypes[n.DepartureSchedule.FareType];n.ReturnSchedule&&(n.ReturnFareTypeDetails=fareTypes[n.ReturnSchedule.FareType]);t=!1;try{t=!!new Blob}catch(i){}n.EnableConfirmationAddToCalendar=enableConfirmationAddToCalendar&&t;Helpers.BindAndShow("confirmation-summary",n,"confirmation-summary-template");s();roadRewardsUser!==null&&(n.RoadRewardsFirstName=" "+roadRewardsUser.firstName);Helpers.BindAndShow("name-header",n,"name-header-template")}function h(n,t){var r,i,u,t;ConfigurationSettings.BounceExchangeId&&(r=Helpers.GetQueryString(),i="",i=roadRewardsUser?roadRewardsUser.email:n.EmailAddress,u={OrderId:r.confirmationnumber,Amount:n.FareTotal,email:i,goal:"purchase",BounceExId:ConfigurationSettings.BounceExchangeId},Helpers.BindAndShow("bouncex-img-template",u),t=t||[],t.push(["conversion",{order_id:r.confirmationnumber,amount:n.FareTotal,email:i,goal:"purchase"}]))}function c(n){n.OutgoingFareTypeDetails=fareTypes[n.DepartureSchedule.FareType];n.ReturnSchedule&&(n.ReturnFareTypeDetails=fareTypes[n.ReturnSchedule.FareType]);Helpers.BindAndShow("change-trip",n,"change-trip-template")}function b(n,t,u){var f,e;if(t.CanCheckIn=!1,t.CheckedIn=!1,t.ShowDefaultConfirmation=!0,n==null)return t;for(f=0;f<n.Passengers.length;f++)if(n.Passengers[f].LastName.toLowerCase()==u.toLowerCase()){t.TicketNumber=n.Passengers[f].TicketNumber;break}for(f=0;f<n.Legs.length;f++)if(n.Legs[f].LegNumber==t.LegNumber){if(t.ShowDefaultConfirmation=!1,n.Legs[f].AllowCheckIn&&(t.CanCheckIn=!0),n.Legs[f].CheckedInTicketNumbers!=undefined)for(e=0;e<n.Legs[f].CheckedInTicketNumbers.length;e++)if(n.Legs[f].CheckedInTicketNumbers[e].toLowerCase()==t.TicketNumber.toLowerCase()){t.CheckedIn=!0;t.CanCheckIn=!1;break}break}r(t);i(t)}var t=Helpers.GetQueryString(),f,e,o,s=function(){if(enableConfirmationAddToCalendar){var n=function(n){f=n.ICSDepartureEvent;e=n.ICSReturnEvent;var t=function(n,t){return function(){var i=new Blob([n],{type:"text/calendar"});return saveAs(i,t),!1}};$gh("#trip-calendar").click(t(f,"DepartureSchedule.ics"));$gh("#return-trip-calendar").click(t(e,"ReturnSchedule.ics"))},i=CachingClientFactory.GetClient("itinerary/"+t.confirmationnumber+"/calendar"),r={lastName:t.lastname};i.GetData(r,n)}},l=function(n){var r,i,t,u,f;if(roadRewardsUser!==null){for(r=!1,i=0;i<n.PassengerDetails.length;i++)if(roadRewardsUser.memberId===n.PassengerDetails[i].RoadRewardsId){r=!0;break}r&&(t=parseInt(fareTypes[n.DepartureSchedule.FareType].PointsEarned),n.IsRoundtrip&&(u=parseInt(fareTypes[n.ReturnSchedule.FareType].PointsEarned),t=t+u),f={FirstName:roadRewardsUser.firstName,PointsEarned:t,TotalPoints:parseInt(roadRewardsUser.points)+t},Helpers.BindAndShow("rewards-earned",f))}},a=function(n){var t;switch(n.FareType){case"Economy":t="economy";break;case"EconomyExtra":t="economy-extra";break;case"Flexible":t="flexible";break;default:t="default"}$gh(".change-trip-info."+t).show()},v=function(n){var i,u,t,r;StaticMap.init({schedule:n.DepartureSchedule,size:"1080x255",mapDivId:"outgoing-map"});i=AugmentStopData(n.DepartureSchedule);n.DepartureSchedule.showOtherBusLines=i.showOtherBusLines;n.DepartureSchedule.Stops=i.Stops;n.DepartureSchedule.StopsKey=GenerateStopsKey(n.DepartureSchedule.Stops);u=Helpers.GetQueryString();t=u.leg;t!=""&&t!=undefined&&(n.IsFromMyTrips=!0,n.LegNumber=t);Helpers.BindAndShow("dropdown-tabs-confirmation",n,"dropdown-tabs-confirmation-template");Helpers.BindAndShow("outgoing-stops",n.DepartureSchedule,"stop-details-template");Helpers.BindAndShow("baggage-info",n.OutgoingFareTypeDetails,"baggage-template");n.ReturnSchedule?(StaticMap.init({schedule:n.ReturnSchedule,size:"1080x255",mapDivId:"return-map"}),r=AugmentStopData(n.ReturnSchedule),n.ReturnSchedule.showOtherBusLines=r.showOtherBusLines,n.ReturnSchedule.Stops=r.Stops,n.ReturnSchedule.StopsKey=GenerateStopsKey(n.ReturnSchedule.Stops),Helpers.BindAndShow("return-stops",n.ReturnSchedule,"stop-details-template"),Helpers.BindAndShow("return-baggage-info",n.ReturnFareTypeDetails,"baggage-template")):$gh(".trip-detail-tabs nav").hide();t==2&&($gh("#tab-2").addClass("active"),$gh("#tab-1").removeClass("active"));$gh("#stop-details").show()},y=function(n){n.PaymentType==="Cash"&&$gh("#pay-locations").show()},p=function(n){var t=function(n){var r=!1,i,t;if(n&&n.Stops)for(i=n.Stops,t=0;t<i.length;t++)ConfigurationSettings.GreyhoundBusLineCodes.indexOf(i[t].Carrier)<0&&(r=!0);return r};n.HasSpecialNeeds&&(t(n.DepartureSchedule)||t(n.ReturnSchedule))&&$gh(".carrier-info").removeClass("ghidden")},w=function(n){var t=n.DepartureSchedule.DepartureStation.Latitude,i=-n.DepartureSchedule.DepartureStation.Longitude;n.departureStation=n.DepartureSchedule.DepartureStation.StationName;n.geoCoordinates=t+","+i;n.eventDate=n.DepartureSchedule.DepartureDateTime;Helpers.BindAndShow("parking-panda",n,"parkingpanda-template")},k=function(n){var u=Helpers.GetQueryString(),t=u.leg,f;t===undefined?t="":n.LegNumber=t;f=function(n){var f=function(f){t==""?(n.ShowDefaultConfirmation=!0,n.CanCheckIn=!1,n.CheckedIn=!1,r(n),i(n)):(n.legNumber=t,b(f,n,u.lastname))},e=function(){n.ShowDefaultConfirmation=!0;n.CanCheckIn=!1;n.CheckedIn=!1;r(n);i(n)},o=ApiClientFactory.GetClient("precheckin/"+u.confirmationnumber,ConfigurationSettings.ApiUrl,!1),s={lastName:u.lastname};o.GetData(s,f,e)};n.TicketingMethod=="ETicket"||n.TicketingMethod=="WillCall"?f(n):(n.ShowDefaultConfirmation=!0,r(n),i(n));w(n);c(n);l(n);a(n);v(n);y(n);p(n);typeof bouncex!="undefined"&&h(n,bouncex);$gh(".loader-overlay").hide(0,function(){$gh(".confirmation-page").removeClass("ghidden");d($,ResponsiveBootstrapToolkit)})},d=function(n,t){if((t.is("md")||t.is("lg"))&&n(".booking-details table")){var i=n(".trip-details-wrap table").outerHeight(),r=n(".payment-details-wrap table").outerHeight();i>r&&n("table td.payment-details-wrap .payment-details-wrap-mh").css("height",i+"px")}},g=function(){var n=document.createElement("script");document.createElement("script");n.setAttribute("type","text/javascript");n.setAttribute("src","https://www.parkingpanda.com/scripts/widgets/main.js");(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(n);clearTimeout(o)},nt=function(){$gh(".loader-overlay").hide(0,function(){$gh(".confirmation-page").removeClass("ghidden")});$gh("#confirmation-page").hide();$gh("#no-ticket-found").show();dataLayer.push({event:"confirmation_error",error_reason:"no-ticket-found"})},tt=function(){$("#eticket-modal").dialog({autoOpen:!1,maxWidth:980,width:"auto",modal:!0,draggable:!1,resizable:!1,title:"",open:function(){$(".ui-dialog-titlebar").remove();$(".title").focus()}});$("#eticket-modal .close").on("click",function(){$("#eticket-modal").dialog("close")}).on("keydown",function(n){var t=n.which;(t===13||t===32)&&$(this).click()})},u;$(".eTicketModal").on("click",function(){u()});u=function(){$("#eticket-modal").dialog("open")};$gh("#pay-locations").hide();n.GetConfirmation(t.confirmationnumber,t.lastname,k,nt);o=setTimeout(g,2e3);tt()}function i(){var n=Helpers.GetQueryString(),t="confirmationnumber="+n.confirmationnumber+"&lastname="+n.lastname;$("#loginExtraParameters").val(t)}function r(){RetailerMap.init();ActivityBar.init()}function u(){t();r();i()}var n={GetConfirmation:function(n,t,i,r){var u=CachingClientFactory.GetClient("itinerary/"+n),f={lastName:t};u.GetData(f,i,r)}};return{init:u}}function TicketsPage(){var n={GetTickets:function(n,t,i,r){var u=CachingClientFactory.GetClient("itinerary/"+n+"/tickets");u.GetData({lastName:t},i,r)}},t=function(){var i=function(n,t){var i=$gh("#tickets-template"),o=Handlebars.compile(i.html()),f,r;i.html(o(t));f=n.length;r=0;$gh.each(n,function(n,t){var i=new Image;i.onload=function(){$gh("img[data-code="+t+"]").attr("src",this.src);r++};i.src="/barcode/"+t});var u=0,e=500,s=3e4,h=setInterval(function(){u=u+e;(f===r||u>=s)&&($gh(".loader-overlay").hide(),i.show(),clearInterval(h))},e)},r=function(n){for(var i,r=AjaxClientFactory.GetClient(ConfigurationSettings.GateAssignmentUrl),t=0;t<n.Tickets[0].Coupons.length;t++)i={message:{schedule:n.Tickets[0].Coupons[t].ScheduleNumber,terminalCode:n.Tickets[0].Coupons[t].Origin.LocationCode,scheduleDate:n.Tickets[0].Coupons[t].DepartDateTime}},function(t,f){r.PostData(i,function(i){u(i,n,t,f)},function(n){$gh(".gate-loading").hide();$gh(".check-gate-default").show();console.log(n)},{gpid:GpidRepo.GetGpid()})}(n.Tickets.length,t)},u=function(n,t,i,r){var u,f;if(n.gateAssigned!=null)for(u=0;u<i;u++)$gh("#check-gate"+u+""+r).hide(),f=$gh("#gate-text"+u+""+r).html(),$gh("#gate-text"+u+""+r).html(f+" "+n.gateAssigned),$gh(".gate-loading").hide(),$gh("#gate-text"+u+""+r).show();else $gh(".gate-loading").hide(),$gh(".check-gate-default").show()},f=function(n){var h,s,e,u,c,o,t,f;for(n.ShowThingsToDoBeforeBoarding=!1,h=ConfigurationSettings.ShowThingsToDoBeforeBoarding,h==="True"&&(n.ShowThingsToDoBeforeBoarding=!0),s=[],e=0;e<n.Tickets.length;e++)for(u=n.Tickets[e],u.SpecialNeeds=null,u.PassengerSpecialNeeds&&(u.SpecialNeeds=_.find(specialNeeds,function(n){return _.invert(specialNeeds)[n]===u.PassengerSpecialNeeds})),u.SpecialNeeds&&(u.SpecialNeeds=u.SpecialNeeds.replace(/ /g,"<br />")),c=[u.Origin.LocationCode,u.Destination.LocationCode],o=0;o<u.Coupons.length;o++){for(t=u.Coupons[o],t.IsGreyhound=t.RevenueCarrierName.toUpperCase()==="GREYHOUND LINES, INC.",t.Carrier.IsGreyhound=ConfigurationSettings.GreyhoundBusLineCodes.indexOf(t.Carrier.CarrierCode)>=0,t.ShowVoucher=Boolean(c.indexOf(t.Origin.LocationCode)>=0),f=0;f<n.Legs.length;f++)if(t.LegNumber===n.Legs[f].LegNumber){t.FareType=n.Legs[f].FareType;t.IsPriorityBoarding=n.Legs[f].IsPriorityBoarding;t.IsSecondBagFree=n.Legs[f].IsSecondBagFree;t.FareTypeDetail=fareTypes[t.FareType];break}s.push(t.BarCodeData)}n.DeliveryMethod==="PrintAtHome"||n.DeliveryMethod==="ETicket"?(i(s,n),ConfigurationSettings.EnableGateAssignment&&($gh(".check-gate-default").hide(),$gh(".gate-loading").show(),r(n))):($gh(".loader-overlay").hide(),Helpers.BindAndShow("vouchers-template",n))},e=function(n){window.location=ConfigurationSettings.GenericErrorUrl+"?errorCode="+encodeURIComponent(n.Code)},t=Helpers.GetQueryString();t.confirmationnumber&&t.lastname&&n.GetTickets(t.confirmationnumber,t.lastname,f,e)},i=function(){t()};return{init:i}}var Ecom,DecodeHtml,PaymentPageJs,saveAs;(function(n){var t;(function(n){var t;(function(n){n[n.Unknown=0]="Unknown";n[n.AmericanExpress=1]="AmericanExpress";n[n.DinersClub=2]="DinersClub";n[n.Discover=3]="Discover";n[n.Jcb=4]="Jcb";n[n.Mastercard=5]="Mastercard";n[n.Visa=6]="Visa"})(t||(t={}));var r=function(){function n(n,t){this.start=n;this.end=t?t:n}return n.prototype.isMatch=function(n){if(this.start===this.end)return n.match("^"+this.start)!==null;var t=this.getFirstDigits(this.start.toString().length,n);return t>=this.start&&t<=this.end},n.prototype.getFirstDigits=function(n,t){if(!t)throw new RangeError("cardNumber cannot be null or empty");n>t.length&&(n=t.length);var r=t.substr(0,n),i;try{i=parseInt(r)}catch(u){throw new RangeError("cardNumber is not numeric");}return i},n}(),i=function(){function n(n,t,i){var u,o,h,f,s,e;if(t===void 0&&(t=null),i===void 0&&(i=null),this.cardType=n,this.iinRanges=[],t!==null)for(u=0,o=t;u<o.length;u++)h=o[u],this.iinRanges.push(new r(h));if(i!==null)for(f=0,s=i;f<s.length;f++){if(e=s[f],e.length!==2)throw new RangeError("Invalid dimensions on range");this.iinRanges.push(new r(e[0],e[1]))}}return n.prototype.matchesNumber=function(n){for(var u,t=!1,i=0,r=this.iinRanges;i<r.length;i++)if(u=r[i],t=u.isMatch(n),t)break;return t},n}(),u=function(){function n(){}return n.getCardTypeFromNumber=function(n){for(var r,u=t.Unknown,i=0,f=this.cardTypeIdentifiers;i<f.length;i++)if(r=f[i],r.matchesNumber(n)){u=r.cardType;break}return t[u]},n}();u.cardTypeIdentifiers=[new i(t.Visa,[4]),new i(t.Mastercard,null,[[51,55],[222100,272099]]),new i(t.AmericanExpress,[34,37]),new i(t.Discover,[65,6011],[[644,649],[622126,622925]]),new i(t.DinersClub,[36,38,39,309],[[300,305]]),new i(t.Jcb,null,[[3528,3589]])];n.CardTypeIdentifier=u})(t=n.CreditCards||(n.CreditCards={}))})(Ecom||(Ecom={}));DecodeHtml=function(n){var t=document.createElement("textarea");return t.innerHTML=n,t.value};window.console||(window.console={log:function(){}});var Helpers={GetErrorObject:function(n,t,i,r,u){var f={Status:n,Url:t,Code:i,Message:r,Response:u,toString:function(){var n=this.Status;return this.Url&&(n+=" calling "+this.Url),n+(" ("+this.Code+": "+this.Message+")")}};return Helpers.Log(f.toString()),f},DistinctSortedRewardsList:function(){var n=[],t=function(t){for(var r=!0,i=0;i<n.length;i++)n[i].Description===t.Description&&(n[i].ExpireDate>t.ExpireDate?(n.splice(i,1),i--):r=!1);r&&n.push({PromotionCode:t.PromotionCode,Description:t.Description,RewardValue:t.RewardValue,NumericCode:t.NumericCode,IssueDate:t.IssueDate,ExpireDate:t.ExpireDate,Tier:t.Tier,Status:t.Status,Type:t.Type})},i=function(n,t){var i=new Date(n.ExpireDate).getTime(),r=new Date(t.ExpireDate).getTime();return i>r?1:-1};return ConfigurationSettings.AmiaServiceEnabled||roadRewardsUser!==null&&roadRewardsUser.earnedRewards.Reward!==null&&(roadRewardsUser.earnedRewards.Reward.forEach(function(n){n.Description.match(/food/gi)||t(n)}),n.sort(i)),n},NumberInflection:function(n,t,i){var r=n;return typeof passengerTypeLabels!="undefined"&&(r=t>1?passengerTypeLabels[n].Plural:passengerTypeLabels[n].Singular),i&&(r=t+" "+r),r},ParseForm:function(n){var i=$gh("#"+n).serializeArray(),t={};return i.forEach(function(n){t[n.name]==null?t[n.name]=n.value:($gh.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n.value))}),t},GetQueryString:function(){var r={},i=window.location.search.substr(1).split("&"),t,n;if(i!=="")for(t=0;t<i.length;++t)n=i[t].split("=",2),n.length>0&&(n[0]=n[0].toLowerCase(),r[n[0]]=n.length===1?"":decodeURIComponent(n[1].replace(/\+/g," ")));return r},ShowDiscountText:function(n){var t,i;return n.discountType?(n.discountType==="roadRewards"?t="Road Reward":n.discountType==="companion"?t="Companion":n.discountType==="coupon"&&n.discountCode===""?t="":(i=n.discountType.charAt(0).toUpperCase()+n.discountType.substring(1),t=i),t):""},BindAndShow:function(n,t,i){var u=$gh("#"+n),r,f;r=i?$gh("#"+i).html():u.html();r!==undefined&&(f=Handlebars.compile(r),u.html(f(t)),u.show(),r.indexOf("placeholder")>-1&&(handlePlaceHolders(),iePlaceHolders.init()))},Log:function(n){window.console.log(n)},RedirectToError:function(n,t){if(n)$gh.ajax({url:"/services/GetErrorMessage",data:{errorCode:n,errorUrl:t},dataType:"json",type:"GET",contentType:"application/json",success:function(n){var t=new URI(n.errorUrl);window.location=n.redirectToErrorUrl&&t&&(t.domain()===""||t.domain()===new URI(window.location.href).domain())?n.errorUrl:ConfigurationSettings.GenericErrorUrl+"?errorCode="+n.errorCode},error:function(){window.location=ConfigurationSettings.GenericErrorUrl+"?errorCode="+response.errorCode}});else{var i=new URI(t);window.location=i&&(i.domain()===""||i.domain()===new URI(window.location.href).domain())?t:ConfigurationSettings.GenericErrorUrl}},LongDateFormatString:"YYYY[-]MM[-]DD[T]HH[:]mm[:]ss",IeSafeVal:function(n){var t=n.val();return t===n.attr("placeholder")&&(t=""),t}},GpidRepo={GetGpid:function(){var t="GPID",i=function(){var i="W"+moment().format("YYYYMMDDHHmmssSS")+Math.floor(Math.random()*1e3),n={id:i,timestamp:new Date};return Cookies.set(t,n),n},n=Cookies.getJSON(t);return n?moment(n.timestamp).isBefore(moment().subtract(1,"days"))&&(n=i()):n=i(),n.id}},AjaxClientFactory={GetClient:function(n,t){var i;t!=undefined&&(n+=t);var r=function(n){var t="";return n!==null&&($gh.each(n,function(n,i){i!==null&&$gh.trim(i.toString())!==""&&typeof i!="function"&&(t+="&"+n+"="+encodeURIComponent(i))}),t.length>0&&(t="?"+t.substring(1))),t},u=function(t,u,f,e,o){var s,h;i=n;s="application/json";t==="GET"&&(i+=r(u),s="application/x-www-form-urlencoded");Helpers.Log(i);h={url:n,data:u,type:t,contentType:s,success:function(n){f(n)},error:function(n,t,r){var u=Helpers.GetErrorObject("Error",i,0,r);e(u)}};o&&(h.headers=o);$gh.ajax(h)},f=function(n,t,i,r){u("GET",n,t,i,r)},e=function(n,t,i,r){n=JSON.stringify(n);u("POST",n,t,i,r)},o=function(){return i};return{GetData:f,PostData:e,GetLastRequestedUrl:o,GetQueryString:r}}},ApiClientFactory={};ApiClientFactory.GetClient=function(n,t,i){arguments.length<2&&(t=ConfigurationSettings.ApiUrl);i===undefined&&(i=!0);var o=t+n,r=AjaxClientFactory.GetClient(o),u=function(n){return n||(n={}),typeof ssoAgent!="undefined"&&(n.sellingAgencyNumber=ssoAgent.AgencyNumber,n.sellingAgentUsername=ssoAgent.Username),n},f=function(n){return n||(n=function(n){alert(n.toString())}),n},e=function(n,t){return function(i){var u=i.Status,f,e,o;u&&u.toLowerCase()==="success"?(f=i.Data,n(f)):(e=function(n,t){var i;return i=t.Code===101003?t.Data.TripsErrorMessage:t.Message,Helpers.GetErrorObject(t.Status,n,t.Code,i,t)},o=e(r.GetLastRequestedUrl(),i),t(o))}},s=function(n,t,o){n=u(n);i&&(n.GPID=GpidRepo.GetGpid());r.GetData(n,e(t,o),f(o))},h=function(n,t,o){n=u(n);var s=null;i&&(s={GPID:GpidRepo.GetGpid()});r.PostData(n,e(t,o),f(o),s)};return{GetData:s,PostData:h,GetQueryString:r.GetQueryString}};var SsoEncode=function(){var n=Helpers.GetQueryString(),f=$gh("#callcenter"),t,i,r,u;f.hide();t=function(n){$gh.ajax({url:"//"+$gh(location).attr("hostname")+"/Services/AgentCodeSet?ssoCode="+escape(n),type:"POST"})};typeof ssoAgent!="undefined"&&(i={AgentName:ssoAgent.Username,AgencyNumber:ssoAgent.AgencyNumber},Helpers.BindAndShow("callcenter",i));r=function(){};n.sso&&(u=ApiClientFactory.GetClient("singleSignOn/"+n.sso),u.GetData(null,t,r))}(),SessionRepo={SetObject:function(n,t){typeof Storage!="undefined"&&sessionStorage.setItem(n,JSON.stringify(t))},GetObject:function(n){var t=null;return typeof Storage!="undefined"&&(t=sessionStorage.getItem(n),t=t&&JSON.parse(t)),t},Delete:function(n){typeof Storage!="undefined"&&sessionStorage.removeItem(n)},ClearObjects:function(n){var t,i,u,r;if(typeof Storage!="undefined"){for(t=[],i=0;i<sessionStorage.length;i++)u=sessionStorage.key(i),n(u)&&t.push(u);for(r=0;r<t.length;r++)sessionStorage.removeItem(t[r])}}},SessionTracker=function(){var u="contextStart",s=ConfigurationSettings.SessionDuration,n=!1,t=null,f=!1,h=function(n){f=n},i=function(n){f&&console.log("Session: "+n)},c=function(){var n=SessionRepo.GetObject(u);return n!==null&&(n=moment(n)),n},l=function(n){if(moment(n).isValid()){var t=moment(n);SessionRepo.SetObject(u,t.toJSON())}},r=function(){var n=null,t=c(),r;return t!==null?(r=moment().diff(t,"minutes",!0),n=s-r,i("Start="+t.format("HH:mm:ss")+", Elapsed="+r+", Remaining="+n)):i("Error - getStart() returned invalid start time"),n},a=function(){var n=r();return n!=null?n<=0:null},e=function(){var f,u;n&&(f=r(),f!==null&&(u=f-Math.floor(f),u===0&&(u=1),u*=6e4,i("Next check in "+u+" milliseconds"),t!==null&&setTimeout(t(f),0),window.setTimeout(e,u)))},v=function(i){n=!0;t=i;e()},o=function(){n=!1},y=function(){o();Cookies.remove("scheduleData");SchedulesRepo.ClearCachedSchedules();window.location=ConfigurationSettings.SessionTimeoutRedirectUrl};return{SetStart:l,GetTimeRemaining:r,IsExpired:a,StartTracking:v,StopTracking:o,RedirectToTimeout:y,SetVerboseMode:h}}(),CachingClientFactory={};CachingClientFactory.GetClient=function(n){function i(i,r,u){function s(n){n._cachedTime=new Date;SessionRepo.SetObject(f,n);r(n)}function h(n){SessionRepo.Delete(f);c(n)}function c(n){u&&u(n)}typeof ssoAgent!="undefined"&&(i||(i={}),i.sellingAgencyNumber=ssoAgent.AgencyNumber,i.sellingAgentUsername=ssoAgent.Username);var f=n+t.GetQueryString(i),e=null,o=function(n){if(e=SessionRepo.GetObject(f),e===null)SessionRepo.SetObject(f,"pending"),t.GetData(i,s,h);else if(e==="pending")n++,n<120?setTimeout(function(){o(n)},500):c(Helpers.GetErrorObject("Error",f,0,"Timeout waiting for request to complete."));else{var u=(new Date-Date.parse(e._cachedTime))/6e4;u>15?(SessionRepo.SetObject(f,"pending"),t.GetData(i,s,h)):r(e)}};o(0)}var t=ApiClientFactory.GetClient(n);return{GetData:i}};var SearchRepo=function(){"use strict";var n="fareData",t=function(t){t.version=ConfigurationSettings.CookieVersion;Cookies.set(n,JSON.stringify(t),{expires:90})},i=function(){var t=Cookies.getJSON(n),r=ConfigurationSettings.CookieVersion,i;if(t!==undefined&&t.version===r)t.returnOn&&(i=new Date(Date.parse(getServerDate())),moment(t.returnOn).format("YYYYMMDD")<moment(i).format("YYYYMMDD")&&(t.returnOn=i)),t.GetTotalPassengers=function(){return parseInt(t.adults)+parseInt(t.children)+parseInt(t.seniors)},t.HasWheelchairTraveler=function(){return t.adultWheelchairs>0||t.seniorWheelchairs>0||t.childWheelchairs>0},t.HasReturnFare=function(){return Boolean(t.returnOn&&t.returnOn!=="")};else return undefined;return t},r=function(){Cookies.remove(n)};return{Save:t,GetCurrent:i,Clear:r}}(),SchedulesRepo=function(n){var i="schedules",t="YYYY-MM-DD",r=function(n,t){var h=Math.floor((t-1)/2),i=moment(n).subtract(h,"days"),o=moment().startOf("day"),s=o.clone().add(1,"days"),r,u,f,e;for(i.isBefore(s)&&(i=s.clone()),moment(n).isBefore(i)&&(i=moment(n)),r=o.clone().add(363,"days"),u=i.clone().add(t-1,"days"),u.isAfter(r)&&i.subtract(u.diff(r,"days"),"days"),f=[],e=0;e<t;e++)f.push(i.clone().toDate()),i.add(1,"days");return f},u=function(n,t){return n!==null&&n?CachingClientFactory.GetClient(t):ApiClientFactory.GetClient(t)},f=function(n,i){if(ConfigurationSettings.UseCalendarSearch){var u=r(i,ConfigurationSettings.CalendarTilesCountRegular);n.calStart=moment(u[0]).format(t);n.calEnd=moment(u[u.length-1]).format(t)}return n},e=function(r,e,o,s,h){var c,y,a,l,v,p;if(c=o===null?n.GetCurrent():$gh.extend(!0,{},o),c){c.discountType==="roadRewards"&&(roadRewardsUser!==null&&roadRewardsUser.memberId&&roadRewardsUser.memberId!==""||(delete c.discountType,delete c.discountCode,delete c.promotionCode,n.Save(c)));y=u(h,i);c.webOnly=s;a=function(n,t){var i=function(n){if(n===null||n===undefined||n==="undefined"||n==="")throw"Invalid location parameter";return n},r=JSON.parse(t[n+"Code"]);t[n+"Code"]=i(r.stopCode);t[n+"City"]=i(r.stopCity);t[n+"StateAbbreviation"]=i(r.stopStateAbbr);t[n+"StateCode"]=i(r.stopStateCode)};try{a("origin",c);a("destination",c)}catch(w){n.Clear();e(Helpers.GetErrorObject("Error","","400039","Invalid location parameter"));return}c.discountType==="student"?(c.discountType="StudentAdvantage",c.discountCardNumber=c.studentCardNumber,l=c.studentExpiration.replace("/","/01/"),c.discountExpiration=moment(l,"MM/DD/YY").endOf("month").format(t),delete c.studentCardNumber,delete c.studentExpiration):c.discountType==="veteran"?(c.discountType="VeteransAdvantage",c.discountCardNumber=c.veteransCard,l=c.veteransExpiration.replace("/","/01/"),c.discountExpiration=moment(l,"MM/DD/YY").endOf("month").format(t),delete c.veteransCard,delete c.veteransExpiration):c.discountType==="roadRewards"?(c.discountType="RoadReward",c.discountCardNumber=roadRewardsUser===null?"":roadRewardsUser.memberId):c.discountCode&&c.discountCode!==""?c.discountType||(c.discountType="Coupon",c.discountCode=encodeURIComponent(c.discountCode)):c.discountType==="companion"?c.discountType="CompanionFare":delete c.discountType;delete c.travelonwchair;c=f(c,c.departOn);c.departOn=moment(c.departOn).format(t);v=!1;c.returnOn&&(c.returnOn=moment(c.returnOn).format(t),v=!0);p=function(n){return function(t){t.IsRoundTrip=n;r(t)}};y.GetData(c,p(v),e)}else e(Helpers.GetErrorObject("Error",null,"000","Invalid fareObj '"+o.toString()+"'"))},o=function(n,t,r,e){if(r){r.returnDate=moment(r.returnDate).format("YYYY-MM-DD");r=f(r,r.returnDate);var o=function(){return function(t){t.IsRoundTrip=!0;n(t)}},s=u(e,i+"/returns");s.GetData(r,o(),t)}else t(Helpers.GetErrorObject("Error",null,"000","Invalid params '"+r.toString()+"'"))},s=function(){SessionRepo.ClearObjects(function(n){return n.indexOf(i)===0})};return{ClearCachedSchedules:s,GetSchedules:e,GetReturnSchedules:o,GetDatesArray:r}}(SearchRepo),PriceRepo={};PriceRepo.GetConfirmation=function(n,t,i,r){var e=function(t){t.AddFee=function(n,t){var i=_.find(this.Fees,function(t){return t.FeeType===n});i?i.Amount=t:this.Fees.push({Amount:t,FeeType:n})};t.GetFee=function(n){var t=0,i=_.find(this.Fees,function(t){return t.FeeType===n});return i&&(t=i.Amount),t};t.RemoveFee=function(n){this.Fees=_.filter(this.Fees,function(t){return t.FeeType!==n})};n(t)},u,f;u=i===null?Cookies.getJSON("scheduleData").PriceConfirmationParameters:$gh.extend(!0,{},i);u?(f=r!==null&&r?CachingClientFactory.GetClient("schedules/priceQuote"):ApiClientFactory.GetClient("schedules/priceQuote"),f.GetData(u,e,t)):t(Helpers.GetErrorObject("Error",null,"000","Invalid scheduleSelectionObj '"+i.toString()+"'"))};var loginValidationRequest=function(n){var t=GpidRepo.GetGpid(),i=location.origin+location.pathname;$("#"+n+" .gpId").val(t);$("#"+n+" .currentPageUrl").val(i);$("#"+n).submit()},DatePickerNextOneYear=function(n,t){var i=getServerDate(),r=getServerDate();return i.setUTCDate(i.getUTCDate()),r.setMonth(i.getMonth()+12),r.setDate(r.getDate()-2),new DatePickerProvider(n,t,i,r)},DatePickerBeforeToday=function(n,t){var i=getServerDate();return i.setUTCDate(i.getUTCDate()),new DatePickerProvider(n,t,null,i)},DatePickerAfterToday=function(n,t){var i=getServerDate();return i.setUTCDate(i.getUTCDate()),new DatePickerProvider(n,t,i,null)},DatePickerAll=function(n,t){return new DatePickerProvider(n,t,null,null)},DatePickerProvider=function(n,t,i,r){"use strict";var e=getServerDate(),o=getServerDate(),s=getServerDate(),h=ConfigurationSettings.DatePickerLanguage,c=function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate()+1)},l=function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate()+7)},a=function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate()+14)},u=function(t){n.support.placeholder||t.each(function(){n(this).val()===""&&n(this).val(n(this).attr("placeholder"))})},f=function(f){function y(t){t.keyCode==8||t.keyCode>=48&&t.keyCode<=57||t.keyCode==191;l.length===0&&(l=n("#ui-datepicker-div").find(".ui-datepicker-calendar>thead>tr>th"));var i=n(l[n(".ui-state-hover").closest("td").index()]).find("span").attr("title");i!==undefined?i+=", "+n(".ui-datepicker-month").html()+" "+n(".ui-state-hover").html()+" "+n(".ui-datepicker-year").html()+".":i="";n("#ariaSpeech").attr("aria-live","polite").text(i)}function k(t){var f=w(h.val()),i,u,r;return f&&(i=n.datepicker.parseDate(n.datepicker._defaults.dateFormat,h.val())),u=w(e.val()),u&&(r=n.datepicker.parseDate(n.datepicker._defaults.dateFormat,e.val())),i&&r?[!0,i&&(t.getTime()==i.getTime()||r&&t>=i&&t<=r)?"range":""]:[!0]}function w(n){return moment(n,"MM/DD/YYYY",!0).isValid()}var a,s,p,h;n.datepicker._updateDatepicker_original=n.datepicker._updateDatepicker;n.datepicker._updateDatepicker=function(t){n.datepicker._updateDatepicker_original(t);var i=this._get(t,"afterShow");i&&i.apply(t.input?t.input[0]:null)};var c=f.find(".date-couple"),h=c.find("#datepicker-from"),o=c.find(".date-to"),e=c.find("#datepicker-to"),v=c.find(".remove-date"),b=o.hasClass("return-trip-enabled"),d=i,l=n("#ui-datepicker-div").find(".ui-datepicker-calendar>thead>tr>th");o.unbind("click").bind("click",function(t){t.preventDefault();o.removeClass("form-disabled");o.find("#datepicker-to").prop("disabled",!1);o.find("#datepicker-to").removeClass("disabled");o.find("#datepicker-to").attr("tabindex","0").focus();n(this).attr("tabindex","-1");v.show();n(".ff-search").addClass("add-round-trip");n(t.target).is(".date-to")&&(b?e.datepicker("show"):e.datepicker("show"));e.datepicker("refresh")}).bind("keydown",function(t){var i=t.which;(i===13||i===32)&&n(this).click()});v.unbind("click").bind("click",function(t){t.preventDefault();n(this).hide();o.addClass("form-disabled");o.removeClass("error");e.prop("disabled","disabled");e.addClass("disabled");o.addClass("inactive");n(".ff-search").removeClass("add-round-trip");n(".enable-picker").attr("tabindex","0");e.datepicker("option","setDate","");e.val("");u(e)});n(".enable-picker").unbind("click").bind("click",function(){});a=SearchRepo.GetCurrent();s="";a?(s=new Date(Date.parse(a.departOn)),moment(s).format("MM/DD/YYYY")<moment(i).format("MM/DD/YYYY")&&(s=i)):s=i;p="mm/dd/yyyy";h=n("#datepicker-from").datepicker({format:"mm/dd/yyyy",minDate:i,maxDate:r,beforeShow:function(t){n("html").hasClass("no-smil")||n(t).after(n(t).datepicker("widget"))},afterShow:function(){t.scrollToReveal(n(".ui-datepicker"),60)}}).on("change",function(){s=n(this).val();e.datepicker("option","minDate",s);h.valid();e.length&&e.valid();u(e)}).on("blur",function(){h.val()!="";try{n.datepicker.parseDate(n.datepicker._defaults.dateFormat,n(this).val())}catch(t){n("#ariaSpeech").text("")}}).keyup(function(n){y(n)});e=n("#datepicker-to").datepicker({format:"mm/dd/yyyy",minDate:s,maxDate:r,beforeShow:function(t){n("html").hasClass("no-smil")||n(t).after(n(t).datepicker("widget"))},afterShow:function(){t.scrollToReveal(n(".ui-datepicker"),60)},beforeShowDay:k}).on("blur",function(){e.val()!=""&&!e.valid();try{n.datepicker.parseDate(n.datepicker._defaults.dateFormat,n(this).val())}catch(t){n("#ariaSpeech").text("")}}).keyup(function(n){y(n)}).on("change",function(){e.valid()})};return{init:f}};$gh(window).load(function(){var n,t;$gh(".datePickerBeforeToday").length>0&&(n=$gh(".datePickerBeforeToday"),t=new DatePickerBeforeToday($gh,Ghound));$gh(".datePickerAfterToday").length>0&&(n=$gh(".datePickerAfterToday"),t=new DatePickerAfterToday($gh,Ghound));$gh(".datePickerNextOneYear").length>0&&(n=$gh(".datePickerNextOneYear"),t=new DatePickerNextOneYear($gh,Ghound));$gh(".fare-finder").length>0&&$gh(".datePickerNextOneYear").length>0&&(n=$gh(".fare-finder"),t=new DatePickerNextOneYear($gh,Ghound));n&&n.length===0&&(n=$gh(".greyhound-datepicker"),t=new DatePickerAll($gh,Ghound));t&&t.init(n)});var PassengerPanel=function(n,t){"use strict";var yt=n(".select-passengers"),a=ConfigurationSettings.MaxPassengerCount,u=1,o=0,ht=2,s=!1,h=!0,r=[],y,p,w,b,i,g=!1,nt=!1,tt=!1,v=function(){return r=[],i.find("li").each(function(){r.push({passenger_type:n(this),passenger_qty:parseInt(n(this).find(".ticket-qty").val(),10),wheelchair_qty:parseInt(n(this).find(".wchair-qty").val(),10)})}),r},rt=function(n,t){var i=parseInt(n,10)+t;return i<0&&(i=0),i},c=function(n){return u=0,n.forEach(function(n){u+=n.passenger_qty}),u},ut=function(n){return o=0,n.forEach(function(n){o+=n.wheelchair_qty}),o=o||0},it=function(t){var r=i.find(".form-control"),u=t+" "+r.attr("data-title");r.val(u).change();n(".passenger-num").html(u)},k=function(n){var r=i.find(".form-control"),t=i.find(".wchair-number");t.find(".wchair-num").html(ut(n));t.is(":hidden")&&t.show()},l=function(t){var u=i.find(".wchair-number"),r=i.find(".book-extra-wchair").hide().attr("aria-hidden","true");t.forEach(function(i){s&&i.passenger_qty>0?i.passenger_type.find(".add-wchair").fadeIn():i.passenger_type.find(".add-wchair").is(":visible")&&(i.passenger_type.find(".add-wchair").fadeOut().end().find(".wchair-qty").val(0).change(),i.wheelchair_qty=0,e(n(".add-wchair .plus")),r.hide());k(t)})},f=function(t){t.each(function(){n(this).prop("disabled",!0).addClass("disabled").parents(".select-passengers").find(".toggle-psgr-btn")})},e=function(t){t.each(function(){n(this).prop("disabled",!1).removeClass("disabled")})},ct=function(n){i.find("#adult-num").val(n.adult);i.find("#adult-wheel-num").val(n.adult_wchair);i.find("#children-num").val(n.children);i.find("#children-wheel-num").val(n.children_wchair);i.find("#senior-num").val(n.seniors);i.find("#senior-wheel-num").val(n.seniors_wchair);(n.adult_wchair>0||n.children_wchair>0||n.seniors_wchair>0)&&(i.find("#travelonwchair").prop("checked",!0),s=!0);ft()},ft=function(){v();i.find("li").each(function(){var t=n(this),i=t.find(".add-passenger .ticket-qty"),s=t.find(".add-wchair .wchair-qty"),o=parseInt(i.val(),10),h=parseInt(s.val(),10);o===0&&f(t.find(".minus"));it(c(r));l(r);ot(t);d(t);k(r);n(this).find(".add-passenger .btn-ctrl").off("click").on("click",function(y){y.preventDefault();st(n(this),i,a,c(r));v();o=parseInt(i.val(),10);h=parseInt(s.val(),10);o<=h&&t.find(".wchair-qty").val(i.val()).change();l(r);it(c(r));lt()?(n(".add-children .add-passenger").addClass("onlychild"),f(n(".add-children .add-passenger .plus")),f(n(".add-children .add-passenger .minus")),n(".add-children .add-passenger input").val(0).change(),v(),it(c(r)),t.parents(".passengers-panel").find(".book-children").show().attr("aria-hidden","false"),nt=!0):(n(".add-children .add-passenger").removeClass("onlychild"),e(n(".add-children .add-passenger .plus")),t.parents(".passengers-panel").find(".book-children").hide().attr("aria-hidden","true"),nt=!1);d(t,n(this));ot(t);l(r);v();d(t,n(this));k(r);u===0&&(n(".select-passengers .error-zero-passenger ").addClass("active"),n(".select-passengers").find(".toggle-psgr-btn").attr("aria-describedby","passengerErrorTop").focus());et(n(this))});n(this).find(".add-wchair .btn-ctrl").off("click").on("click",function(i){var u;i.preventDefault();var f=t.find(".wchair-qty"),e=parseInt(t.find(".add-passenger .ticket-qty").val(),10),o=parseInt(t.find(".add-wchair .ticket-qty").val(),10);st(n(this),f,e,o);v();d(t,n(this));k(r);u=!0;et(n(this),u);n("#travelonwchair").valid()})})},et=function(t,i){var s,h,c,f,e,i=i||!1,r="";n(".passenger-panel-alert").addClass("hidden");h=t.closest("li").hasClass("add-children")?!0:!1;c=t.closest("li").hasClass("add-senior")?!0:!1;s=t.closest("li").hasClass("add-adult")?!0:!1;e=t.hasClass("minus")?!0:!1;f=t.hasClass("plus")?!0:!1;s?f?r+=i?passengerPanelAlerts.adultWcAdded:passengerPanelAlerts.adultAdded:e&&(r+=i?passengerPanelAlerts.adultWcRemoved:passengerPanelAlerts.adultRemoved):h?f?r+=i?passengerPanelAlerts.childWcAdded:passengerPanelAlerts.childAdded:e&&(r+=i?passengerPanelAlerts.childWcRemoved:passengerPanelAlerts.childRemoved):c&&(f?r+=i?passengerPanelAlerts.seniorWcAdded:passengerPanelAlerts.seniorAdded:e&&(r+=i?passengerPanelAlerts.seniorWcRemoved:passengerPanelAlerts.seniorRemoved));r+=" "+passengerPanelAlerts.thereAre+" "+u+" "+passengerPanelAlerts.InTotalSelctedWith+" "+o+" "+passengerPanelAlerts.PassengersTravelingInWheelchair;g&&(r+=" "+passengerPanelAlerts.bookExtra);nt&&(r+=" "+passengerPanelAlerts.bookChildren);tt&&(r+=" "+passengerPanelAlerts.bookExtraWheelchair);r=r.replace("{{MaxPassengerCountPlusOne}}",a+1);n(".passenger-panel-alert").html(r).removeClass("hidden")},ot=function(t){var i,u;y=t.find(".add-passenger .ticket-qty");p=t.find(".add-wchair .ticket-qty");w=parseInt(y.val(),10);b=parseInt(p.val(),10);w===0?f(t.find(".minus")):e(t.find(".minus"));i=c(r);i<a?(e(t.find(".add-passenger .plus")),e(t.parent("ul").find(".add-passenger").not(".onlychild").find(".plus")),t.parent("ul").parent(".passengers-panel").find(".book-extra").hide().attr("aria-hidden","true"),g=!1):(f(t.find(".add-passenger .plus")),f(t.parent("ul").find(".add-passenger .plus")),t.parents(".passengers-panel").find(".book-extra").show().attr("aria-hidden","false"),g=!0,u=" "+passengerPanelAlerts.bookExtra,u=u.replace("{{MaxPassengerCountPlusOne}}",a+1),n(".book-extra").html(u));i>=5&&i<a?t.parent("ul").parent(".passengers-panel").find(".book-group").show().attr("aria-hidden","true"):t.parent("ul").parent(".passengers-panel").find(".book-group").hide().attr("aria-hidden","true")},d=function(t,i){y=t.find(".add-passenger .ticket-qty");p=t.find(".add-wchair .ticket-qty");w=parseInt(y.val(),10);b=parseInt(p.val(),10);b===0?f(t.find(".add-wchair .minus")):e(t.find(".add-wchair .minus"));ut(r)<ht?(t.parents(".passengers-panel").find(".book-extra-wchair").hide().attr("aria-hidden","true"),tt=!1,t.parent("ul").find("> li").each(function(){var t=n(this).find(".ticket-qty").not(".wchair-qty").val(),i=n(this).find(".wchair-qty").val();i<t&&e(n(this).find(".add-wchair .plus"))}),b<w?e(t.find(".add-wchair .plus")):i&&i.is(".plus")&&f(i)):(t.parents(".passengers-panel").find(".book-extra-wchair").show().attr("aria-hidden","false"),tt=!0,f(t.parent("ul").find(".add-wchair .plus")),i&&i.is(".plus")&&i.closest("dl").attr("class")=="add-wchair")},lt=function(){var t=parseInt(n(".add-children .add-passenger").find("input").val(),10);return c(r)===t?!0:!1},st=function(t,i,r,f){var e=parseInt(i.val(),10);return t.is(".plus")?f<r&&(i.val(rt(e,1)).change(),h=u===0?!0:!1,h===!0&&(n(t).parents(".select-passengers").find(".form-group").removeClass("has-error"),n(t).parents(".select-passengers").find(".error-zero-passenger").removeClass("active"))):f<r+1&&i.val(rt(e,-1)).change(),i},at=function(){r.forEach(function(n){s&&n.passenger_qty>0?n.passenger_type.find(".add-wchair").show():n.passenger_type.find(".add-wchair").hide()})},vt=function(f,e){i=f;t.vars.isTouchDevice&&i.find(".toggle-psgr-btn input").removeAttr("readonly").attr("disabled","true");i.mobCollapse({panel:".toggled-psgr-panel",button:".toggle-psgr-btn",mobileonly:!1,closeOnClickout:!0,hidetoggleOnDesk:!0});e?ct(e):ft();i.off("panelOpen").on("panelOpen",function(){n(".farefinder .dropdown-menu").hide();h=u===0?!0:!1});i.find(".passengers-panel").off("beforePanelClosed").on("beforePanelClosed",function(){h=!0;n(this).parent(".select-passengers").find(".form-group").removeClass("has-error");n(this).parent(".select-passengers").find(".error-zero-passenger").removeClass("active");n(this).parent(".select-passengers").find(".error-wchair").removeClass("active");u===0&&(h=!1,n(this).parent(".select-passengers").find(".form-group").addClass("has-error"),n(this).parent(".select-passengers").find(".error-zero-passenger").addClass("active"),n(this).parent(".select-passengers").find(".toggle-psgr-btn").attr("aria-describedby","passengerErrorTop").focus());s&&u!==0&&o===0&&(n(this).parent(".select-passengers").find(".form-group").addClass("has-error"),n(this).parent(".select-passengers").find(".error-wchair").addClass("active"),n(this).parent(".select-passengers").find(".toggle-psgr-btn").attr("aria-describedby","passengerErrorTop").focus())});i.find(".passengers-panel").off("panelClosed").on("panelClosed",function(){});i.find("#travelonwchair").is(":checked")&&(s=!0,l(r));n("#travelonwchair").change(function(){var t=n(this);t.prop("checked")?(s=!0,l(r),n(".add-wchair:visible").first().find(".plus").focus()):(s=!1,l(r))})};return{passenger_sum:u,passengers_validates:h,resetWchairOption:at,init:vt}},FormValidation=function(n){"use strict";var t=function(){function t(t){n(t).validate({debug:!1,onfocusout:!1,focusInvalid:!0,ignore:[],highlight:function(t){n(t).closest(".form-group").addClass("error")},unhighlight:function(t){n(t).closest(".form-group").removeClass("error");n(t).closest(".form-group").find(".error-alert").remove();n(t).is("#totalPassengers")?n(".toggle-psgr-btn").removeAttr("aria-label"):n(t).removeAttr("aria-label").attr("aria-labelledby",n(t).attr("id")+"-label")},invalidHandler:function(t,i){var u=i.numberOfInvalids(),r;u&&(r=n(i.errorList[0].element).is("#totalPassengers")?n(".toggle-psgr-btn"):i.errorList[0].element,setTimeout(function(){n(r).focus()},250))},errorPlacement:function(i,r){if(n("#"+i.attr("id")).remove(),i.prepend('<span class="accessibility_hidden">Error. <\/span>'),i.addClass("error-alert real"),i.prependTo(r.parent()),n(r).removeAttr("aria-labelledby"),n(r).is("select"))r=n(r).next(".ui-selectmenu-button"),n(r).attr("aria-labelledby",n(r).attr("id")+"-label "+i.attr("id"));else if(n(r).is("input[type='checkbox']"))r.attr("aria-labelledby",i.attr("id"));else if(n(r).is("#totalPassengers"))n(".toggle-psgr-btn").attr("aria-label",n(i).text());else{var u=n('label[for="'+n(r).attr("id")+'"]').html();n(r).attr("aria-label",u+". "+n(i).text())}if(n(t).is(".ff-search")){n(".toggle-psgr-btn").on("focus",function(){n(this).closest(".form-group").hasClass("error")&&n(this).parent().find(".error-alert").addClass("active")});n(".toggle-psgr-btn").on("blur",function(){n(this).closest(".form-group").hasClass("error")&&n(this).parent().find(".error-alert").removeClass("active")})}r.on("focus",function(){n(".error-alert").each(function(){n(this).removeClass("active")});n(this).parent().find(".error-alert").addClass("active")});r.on("blur",function(){n(this).parent().find(".error-alert").removeClass("active")});r.next(".bootstrap-select").on("click",function(){n(this).parent().find(".error-alert").addClass("active")})},showErrors:function(){this.defaultShowErrors();n(".error-alert").each(function(){n(this).removeAttr("style");n(this).closest(".form-group").find("input").is(":focus")&&n(this).addClass("active")})}});n(t).validate()}t("#ff-rr-login");t("#rr-signinup-form-BookaTrip");t("#rr-signinup-form-RoadRewards");t("#ff-print-your-ticket-form");t("#meganav-print-your-ticket-form");t(".resend-ticket");t(".ff-search")},u=function(){n(".ff-rr-login").on("keyup blur",function(){n(".ff-rr-number").val()!==""&n(".ff-rr-password").val()!==""?n(".ff-rr-submit").addClass("active"):n(".ff-rr-submit").removeClass("active")})},i=function(){t()};return{init:i}}($gh,Ghound),LocationSearch=function(n){function u(){var e,o,r,h,c;if(SearchRepo.Clear(),Cookies.remove("passengerDetails"),$("#totalPassengers").prop("readonly",!1),n("#ff-travel-promocode").rules("remove","validpromocode"),n("#ff-travel-veteranscard").rules("remove","validpromocode"),n("#ff-travel-studentscard").rules("remove","validpromocode"),n(".ff-search").attr("data-submitted","true"),e=n(".ff-search").valid(),e){if(window.ff_error=!1,o=$(this).siblings("img.loader"),o.removeClass("ghidden"),r=Helpers.ParseForm("fare-search"),r.departOn=$("#datepicker-from").datepicker("getDate"),r.departOn===null)return!1;r.returnOn&&(r.returnOn=$("#datepicker-to").datepicker("getDate"));r.discountCode===n("input[name='discountCode']").attr("placeholder")&&(r.discountCode="");r.discountCode&&!r.discountType&&(r.discountType="coupon");t()&&(r.promotionCode=$("#ff-rewards-select").val());Accessibility.refreshSelect($("#ff-rewards-select"));SearchRepo.Save(r);var u=n("#totalPassengers").attr("data-count"),f=n("#ff-travel-discountoptions").val(),s=n("#ff-rewards-select-menu li.ui-menu-item div.ui-state-active").html();if(u!=""&&u!=undefined&&f!=""&&f!=undefined&&parseInt(u)>1&&f=="roadRewards"&&s!=undefined&&s!="Companion Pass")return h=Helpers.GetErrorObject("Error",null,"40002613","default"),i(h),!1;c=function(){window.location=ConfigurationSettings.ScheduleUrl};SchedulesRepo.GetSchedules(c,i,null,!1,!0)}else return window.ff_error=!0,$("#totalPassengers").prop("readonly",!0),!1}function i(t){for(var i,e,o=function(t){var i=promoCodeErrors[t.Code],e,o,u;if(t.Response&&t.Response.Data){var s=SearchRepo.GetCurrent(),f=function(n){var t=JSON.parse(s[n+"Code"]);return t.stopStateAbbr},r=t.Response.Data;r.DiscountErrorCode&&(i=promoCodeErrors[r.DiscountErrorCode]);r.ErrorDate&&(e=moment(r.ErrorDate),i=i.replace("{{ErrorDate}}",e.format("Do MMM, YYYY")));i=i.replace("{{OriginState}}",f("origin"));i=i.replace("{{DestinationState}}",f("destination"))}o=$("#ff-travel-discountoptions").val();switch(o){case"veteran":u=$("#ff-travel-veteranscard");break;case"student":u=$("#ff-travel-studentscard");break;default:u=$("#ff-travel-promocode")}u.rules("add",{validpromocode:!0,messages:{validpromocode:i}});n(".ff-search").valid()},u=!1,f=ConfigurationSettings.ScheduleSearchIgnoredCodes.split(","),r=0;r<f.length;r++)if(t.Code-f[r]==0){u=!0;break}if(u)scheduleConfirmed();else{if(promoCodeErrors[t.Code]){i=SearchRepo.GetCurrent();i!=undefined&&i!=null&&(delete i.discountCode,SearchRepo.Save(i));o(t);e=$("#fare-search-btn").siblings("img.loader");e.addClass("ghidden");return}Helpers.RedirectToError(t.Code,ConfigurationSettings.NoRoutesErrorUrl)}}var t=function(){return ConfigurationSettings.AmiaServiceEnabled?roadRewardsUser!==null&&n("#rewards-template-amia").length:roadRewardsUser!==null&&n("#rewards-template").length},r=function(){var r,e,f,i;n("#fromLocation").length!==0&&(r=SearchRepo.GetCurrent(),r||(r={originCity:"",originCode:"",destinationCity:"",destinationCode:""}),n("#fare-search-btn").click(u),n(".ff-search").validate(),t()?(n("#invalidPassword").addClass("hidden"),n("#invalidLogin").addClass("hidden"),ConfigurationSettings.AmiaServiceEnabled?i={FirstName:roadRewardsUser===null?"":roadRewardsUser.firstName,Points:roadRewardsUser.points}:(e=Helpers.DistinctSortedRewardsList(),i={FirstName:roadRewardsUser===null?"":roadRewardsUser.firstName,RewardCount:roadRewardsUser.rewards}),ConfigurationSettings.AmiaServiceEnabled?(f=i.Points>0?!0:!1,i.HasRewards=f,Helpers.BindAndShow("rewards-loggedin",i,"rewards-template-amia")):(n(".boostrap-select.ff-travel-rewardoptions").find("button#ff-rewards-select").attr("aria-describeby","rwSelectInstruction"),e.length>0?(f=!0,i.RewardItems=e):f=!1,i.HasRewards=f,Helpers.BindAndShow("rewards-loggedin",i,"rewards-template")),Accessibility.initSelect($("#ff-rewards-select")),r.promotionCode!==undefined&&r.promotionCode!=="none"&&r.promotionCode!=="noReward"&&($(".ff-travel-rewardoptions option[value="+r.promotionCode+"]").attr("selected","selected"),$(".ff-travel-rewardoptions").trigger("selectmenuchange"),Accessibility.refreshSelect($(".ff-travel-rewardoptions")))):loginFailureResultCode=="ValidEmailExists"?n("#invalidPassword").removeClass("hidden"):loginFailureResultCode=="LoginFailed"?n("#invalidLogin").removeClass("hidden"):(n("#invalidPassword").addClass("hidden"),n("#invalidLogin").addClass("hidden")))};return{init:r}}($gh),FareFinder=function(n,t){"use strict";n("#ff-rr-login input[name=password]").keypress(function(t){var r=t.which,i,u;r==13&&(i=n("#ff-rr-login input[name=username]").val(),u=n("#ff-rr-login input[name=password]").val(),loginValidationRequest("ff-rr-login",i))});var i=function(){var t=n("#ff-form-sign-in");t.click(function(){var t=n("#ff-rr-login input[name=username]").val(),i=n("#ff-rr-login input[name=password]").val();loginValidationRequest("ff-rr-login",t)})},r=function(n,t,i){var r=n(window).width();i.each(function(){var i=n(this),u=i.find(".bottom-fold"),e=i.find(".top-fold"),f=i.find(".date-couple");i.find(".ff-search input").on("focus",function(){u.is(":hidden")&&u.fadeIn()});(t.is("xs")||t.is("sm"))&&u.prepend(f);n(window).bind("resize",function(){r!=n(window).width()&&(t.is("xs")||t.is("sm")?u.prepend(f):e.append(f),r=n(window).width())})})},u=function(){n("#datepicker-from, #ff-travel-discountoptions").on("change",function(){n("#datepicker-from").datepicker("getDate")&&n("#ff-travel-discountoptions").length>0&&n("#datepicker-from").valid()})},f=function(){var i=window.loginFailureArea,t=window.loginFailureResultCode;if(i!="fareFinder"){n(".fare-finder-inner .login-error").removeClass("active");return}n.ajax({url:"/services/GetErrorMessage",data:{errorCode:t},dataType:"json",type:"GET",contentType:"application/json",success:function(i){t=="ValidEmailExists"||t=="LoginFailed"||t=="ValidEmailNotExists"?(n(".fare-finder-inner .login-error").text(i.errorMessage),n(".fare-finder-inner .login-error").addClass("active"),$gh(".ff-rr-mobile-toggle > .toggle-btn").addClass("active"),$gh(".ff-rr-mobile-toggle > .toggled-panel").attr("aria-hidden",!1),$gh(".ff-rr-mobile-toggle > .toggled-panel").slideDown(),Accessibility.announceStatusUpdate(i.errorMessage,"assertive","alert")):(n(".fare-finder-inner .login-error").removeClass("active"),Accessibility.announceStatusUpdate("Imma assume you logged in."))},error:function(){}});n(".fare-finder-inner .ff-rr-password,.fare-finder-inner .ff-rr-number").on("focus",function(){n(".fare-finder-inner .login-error").removeClass("active")})},e=function(){$gh(".fare-finder .expire").each(function(){var t=n(this).attr("placeholder"),i=n(this).attr("data-mask")||t;n(this).focus(function(){n(this).attr("placeholder",i)});n(this).blur(function(){n(this).attr("placeholder",t)})})},o=function(o){var h,c,s;r(n,ResponsiveBootstrapToolkit,o);t.getIEVersion()===0&&e();FormValidation.init();LocationSearch.init();u();ConfigurationSettings.AmiaServiceEnabled?i():f();handlePlaceHolders();ConfigurationSettings.EnablePod||(h=o.find(".select-passengers"),h.length>0&&(c=new PassengerPanel(n,t),c.init(h)));s=o.find("#update-search-btn");s.length>0&&(s.addClass("btn-tertiary"),s.addClass("disabled"))};return{init:o}};$gh(window).load(function(){var n=new FareFinder($gh,Ghound);n.init($gh(".fare-finder"))});var ScheduleCalendar=function(n){"use strict";var t,r=function(n,t){var i={IsSoldOut:n};t==="outgoing"?Helpers.BindAndShow("outgoing-calendar-header",i,"outgoing-calendar-header-template"):Helpers.BindAndShow("return-calendar-header",i,"return-calendar-header-template")},i=function(n){var t=function(){n.find(".schedule-day").find(".price-loader").addClass("hidden").end().find(".day-price").removeClass("hidden")};return{ShowFare:function(i,r){t();n.find(".schedule-day").attr("href",r).end().find(".sday-price").css("fontSize","").text(i);n.find(".sold-out").addClass("hidden");n.find(".currency").removeClass("hidden");n.find(".day-from").removeClass("hidden")},ShowMessage:function(i){t();n.find(".schedule-day").attr("href","javascript:void(0)");n.find(".day-price").addClass("hidden");n.find(".sold-out").text(i);n.find(".sold-out").removeClass("hidden");n.find(".currency").addClass("hidden");n.find(".day-from").addClass("hidden")},ShowLink:function(i,r,u){t();this.ShowMessage(i,r);n.find(".schedule-day").attr("href",u)}}},u=function(u,f){var e;f.empty();e=t.selector==="#outgoing-trip .schedule-calendar-wrapper"?"outgoing":"return";var o=function(t){var o=n("#calendar-tile").html();f.find("li").remove();u.forEach(function(u){var v="date-"+u.date_formatted,y=u.date.substring(0,3)+"<br>"+u.date.substring(3),c,s,l,h,a;n(o).addClass(u.date_state).addClass(u.date_selected).addClass(v).attr("id",u.date_selected).attr("aria-selected",u.aria_selected).find(".day-date").html(y).end().appendTo(f);c=f.find("."+v);s=i(c);u.displayFare?(l=!1,h=_.find(t.Calendar,function(n){return n.Date===u.date_formatted}),h?h.NoRouteReason?h.NoRouteReason==="NoneAvailable"?s.ShowMessage(calendarMessages.EmptySchedule,11):(l=!0,s.ShowLink(calendarMessages.SoldOut,14,"javascript:selectNewDate('"+u.date_formatted+"', '"+e+"')")):(a=Math.ceil(h.AveragePrice),t.OutgoingArrivalTime&&t.OutgoingArrivalTime.isAfter(moment(h.Date).endOf("day"))?(s.ShowFare(a,"javascript:void(0)"),n(c).find(".schedule-day").addClass("invalid-travel-date")):s.ShowFare(a,"javascript:selectNewDate('"+u.date_formatted+"', '"+e+"')")):s.ShowLink(calendarMessages.MoreFares,14,"javascript:selectNewDate('"+u.date_formatted+"', '"+e+"')"),u.date_selected==="selected-date"&&(r(l,e),displaySchedule(t,e,u.date_formatted))):s.ShowLink(calendarMessages.MoreFares,14,"javascript:selectNewDate('"+u.date_formatted+"', '"+e+"')")})},s=function(n){Helpers.RedirectToError(n.Code,ConfigurationSettings.NoRoutesErrorUrl)},h=SearchRepo.GetCurrent();e==="outgoing"?getSchedulesForDeparture(h.departOn,!1,o,s):getSchedulesForReturn(h.returnOn,!1,o,s)},f=function(u,f){var s=function(n,t){return function(u){var l=f.find(".date-"+n),s=i(l),a=u.Schedules,h,e,c,o;if(a.length===0)s.ShowMessage(calendarMessages.EmptySchedule,11);else{for(h=!0,e=null,c=0;c<a.length;c++)o=a[c],o.IsSoldOut||(h=!1,o.IsPastETicketCutoffTime||o.LowestFareAverage===undefined||(!e||e>o.OnlineFares.LowestFareAverage)&&(e=o.OnlineFares.LowestFareAverage),o.IsPastETicketCutoffTime&&o.ETicketOnly&&o.LowestFareAverage!==undefined&&(!e||e>o.OnlineFares.LowestFareAverage)&&(e=o.OnlineFares.LowestFareAverage));h?s.ShowLink(calendarMessages.SoldOut,14,"javascript:selectNewDate('"+n+"', '"+t+"')"):e===null?s.ShowMessage(calendarMessages.EmptySchedule,11):(e=Math.ceil(e),s.ShowFare(e,"javascript:selectNewDate('"+n+"', '"+t+"')"));l.attr("id")==="selected-date"&&r(h,t)}l.attr("id")==="selected-date"&&displaySchedule(u,t,n)}},h=function(n){return function(r){var u,e,o;switch(r.Code){case 400013:u=calendarMessages.InvalidSearch;e=20;break;default:u=calendarMessages.EmptySchedule;e=11}o=f.find("."+n);i(o).ShowMessage(u,e);o.attr("id")==="selected-date"&&displayNoSchedulesMessage(t.parents("#outgoing-trip, #return-trip"),!1)}},e,c,o;f.empty();e=t.selector==="#outgoing-trip .schedule-calendar-wrapper"?"outgoing":"return";c=n("#calendar-tile").html();f.find("li").remove();o=[];u.forEach(function(t){var r="date-"+t.date_formatted,h='<span aria-hidden="true">'+t.date.substring(0,3)+"<br>"+t.date.substring(3)+'<\/span><span class="accessibility_hidden">View fares on '+t.aria_date+".<\/span>",u,s;n(c).addClass(t.date_state).addClass(t.date_selected).addClass(r).attr("id",t.date_selected).attr("aria-selected",t.aria_selected).find(".day-date").html(h).end().appendTo(f);t.displayFare?(t.date_id=r,o.push(t)):(u=f.find(".date-"+t.date_formatted),s=i(u),s.ShowLink(calendarMessages.MoreFares,14,"javascript:selectNewDate('"+t.date_formatted+"', '"+e+"')"))});o=_.sortBy(o,function(n){return n.date_selected==="selected-date"?1:0});o.forEach(function(n){var t=!Boolean(n.date_selected==="selected-date"),i=e==="outgoing"||t?0:1e3;setTimeout(function(){e==="outgoing"?getSchedulesForDeparture(n.date_formatted,t,s(n.date_formatted,e),h(n.date_id)):getSchedulesForReturn(n.date_formatted,t,s(n.date_formatted,e),h(n.date_id))},i)})},e=function(n,i,r){var s=moment(n[0]),h=moment(n[n.length-1]),c,o,l,e;i<n.length&&(c=(i-1)/2,s=moment(r).add(Math.ceil(c*-1),"days"),h=moment(r).add(Math.ceil(c),"days"),o=0,s.isBefore(n[0])&&(o=moment(n[0]).diff(s,"days")),h.isAfter(n[n.length-1])&&(o=moment(n[n.length-1]).diff(h,"days")),o>0&&(s.add(o,"days"),h.add(o,"days")));l=function(n){return Boolean(!s.isAfter(n)&&!h.isBefore(n))};e=[];n.forEach(function(n,t){e.push({date_state:"active",date_selected:"",aria_selected:"false",date:moment(n).format("ddd MMM D"),aria_date:moment(n).format("dddd MMMM D"),date_formatted:moment(n).format("YYYY-MM-DD"),displayFare:l(n)});moment(n).isSame(r)&&(e[t].date_selected="selected-date",e[t].aria_selected="true")});e[0].date_state="first active";ConfigurationSettings.UseCalendarSearch?u(e,t.find(".schedule-calendar")):f(e,t.find(".schedule-calendar"))},o=function(t){function f(){t.owlCarousel({pagination:!1,slideBy:1,onInitialized:function(){t.css("visibility","visible")},responsive:{0:{rewind:!0,items:3,mergeFit:!0},1e3:{items:7}}});t.addClass("owl-carousel");e()}function e(){n(".schedule-controls a").unbind("click").bind("click",function(i){i.preventDefault();n(this).is(".date-next")?t.trigger("next.owl.carousel"):t.trigger("prev.owl.carousel")})}function u(){t.hasClass("owl-carousel")&&(t.trigger("destroy.owl.carousel"),t.removeClass("owl-carousel"))}var i,r=ResponsiveBootstrapToolkit;t.is(".owl-carousel")&&u();t.find(".schedule-day-wrap:visible").each(function(t){n(this).is(".selected-date")&&(i=t===0?t:t-1)});t.on("dragged.owl.carousel",function(n){console.log("event:",n.type)});n(window).resize(function(){t.trigger("to.owl.carousel",[i,0,!0]);r.is("xs")||r.is("sm")?t.hasClass("owl-carousel")||(f(),t.trigger("to.owl.carousel",[i,0,!0])):(u(),t.css("visibility","visible"))});n(window).trigger("resize")},s=function(i,r,u){var o,f;t=r;o=function(){var t=ConfigurationSettings.CalendarTilesCountRegular,r=ConfigurationSettings.CalendarFaresDisplayRegular,n;i.is("sm")||i.is("xs");n=SchedulesRepo.GetDatesArray(u,t);e(n,r,u)};o();f=n(window).width();n(window).resize(function(){var t=n(window).width(),i;t!==f&&(i=n("#return-trip").hasClass("ghidden"),i&&n("#return-trip").hasClass("ghidden")===!1&&n("#return-trip").addClass("ghidden"),f=t)})};return{init:s,doMobileCarousel:o}},ScheduleFlow=function(n,t){"use strict";function o(){var i=new ScheduleCalendar(n,t);i.init(ResponsiveBootstrapToolkit,n("#return-trip .schedule-calendar-wrapper"),new Date(pageGlobal.fareObj.returnOn));n("html").hasClass("keyboard")&&n("#header-main").attr("tabindex","0").focus().blur()}function s(t,i){r(i,pageGlobal.scheduleSelection.OutgoingFareType);n("#"+t+"-trip").addClass("ghidden")}function i(){var n=pageGlobal.currentSchedule,t={departureSchedule:getScheduleByKey(n.DepartureResponse.Schedules,pageGlobal.scheduleSelection.OutgoingScheduleKey),returnSchedule:null};return pageGlobal.scheduleSelection.ReturnScheduleKey&&(t.returnSchedule=getScheduleByKey(n.ReturnResponse.Schedules,pageGlobal.scheduleSelection.ReturnScheduleKey)),t}function h(){var n=i(),u=n.departureSchedule.OnlineFares[pageGlobal.scheduleSelection.OutgoingFareType],t={outboundFareKey:u.FareKey,requestId:pageGlobal.currentSchedule.DepartureResponse.RequestId,ticketingMethod:"WillCall"},r;return n.returnSchedule&&(r=n.returnSchedule.OnlineFares[pageGlobal.scheduleSelection.ReturnFareType],t.returnFareKey=r.FareKey),t}var r=function(t,i){var r=moment(t.DepartureDateTime),u;n(".sb-outgoing .sb-trip-date .sb-day").html(r.format("MMM D YYYY"));n(".sb-outgoing .sb-trip-date .sb-time").html(r.format("h:mm a"));n("#sb-change-faretype").val(i);Accessibility.refreshSelect(n("#sb-change-faretype"));u=t.OnlineFares[i].FareTotal;n("#summarybar-totalfare").html("$"+u.toFixed(2));Helpers.BindAndShow("summarybar-faretypes",t,"summarybar-schedule-template")},u=function(t,i){var r=function(t){var r,e,u,h,c,l;(t.preventDefault(),n(this).find("li.fare-book-wrap>span.sold-out").length>0)||n(this).find("li.fare-book-wrap>span.purchase-unavailable").length>0||(r=Boolean(i.selector==="#outgoing-trip"),pageGlobal.scheduleSelection||(pageGlobal.scheduleSelection={}),e=n(this).attr("data-faretype"),u=n(this).attr("data-schedulekey"),r?(h=pageGlobal.currentSchedule.DepartureResponse.Schedules,c="outgoing",n("#summarybar-schedule").addClass("outgoing-selected"),ScheduleSummaryBar.setupFareSelect()):(h=pageGlobal.currentSchedule.ReturnResponse.Schedules,c="return"),l=getScheduleByKey(h,u),r?(pageGlobal.scheduleSelection.OutgoingFareType=e,pageGlobal.scheduleSelection.OutgoingScheduleKey=u):(pageGlobal.scheduleSelection.ReturnFareType=e,pageGlobal.scheduleSelection.ReturnScheduleKey=u),r&&pageGlobal.fareObj.HasReturnFare()?(n(".loader-overlay").show(),s(c,l),o()):f())};i.find(".fare-row .fare-box > a").bind("click",r);i.find("a.book-btn").bind("click",r);n("#return-trip #selected-date").focus()},f=function(){var r;n("img.loader").show();var t=i(),f=seatNudgeSettings.ShowSeatsRemaining&&parseInt(t.departureSchedule.SeatsAvailable)<=parseInt(seatNudgeSettings.AvailableSeatsThreshold)&&parseInt(t.departureSchedule.SeatsAvailable)>0,u=!1;t.returnSchedule!=null&&(u=seatNudgeSettings.ShowSeatsRemaining&&parseInt(t.returnSchedule.SeatsAvailable)<=parseInt(seatNudgeSettings.AvailableSeatsThreshold)&&parseInt(t.returnSchedule.SeatsAvailable)>0);r={PriceConfirmationParameters:h(),OutgoingDepartureTime:t.departureSchedule.DepartureDateTime,OutgoingArrivalTime:t.departureSchedule.ArrivalDateTime,ReturnDepartureTime:null,ReturnArrivalTime:null,OutgoingFareType:pageGlobal.scheduleSelection.OutgoingFareType,ReturnFareType:pageGlobal.scheduleSelection.ReturnFareType,IsPastETicketCutoffTime:t.departureSchedule.IsPastETicketCutoffTime,SelectedSeatNudgeDepartSchedule:f,SelectedSeatNudgeReturnSchedule:u,ETicketOnly:t.departureSchedule.ETicketOnly};t.departureSchedule.IsPastETicketCutoffTime&&!t.departureSchedule.ETicketOnly?window.location=ConfigurationSettings.TooLateForOnlinePurchase:(t.returnSchedule&&(r.ReturnDepartureTime=t.returnSchedule.DepartureDateTime,r.ReturnArrivalTime=t.returnSchedule.ArrivalDateTime),Cookies.set("scheduleData",JSON.stringify(r)),window.location="payment")},e=function(n,t){u(n,t);handleTooltips()};return{init:e}}($gh,Ghound),ScheduleRow=function(n,t,i){"use strict";function f(t,i){if(displayFilterAndSortButtons(t,!0),u.length===0){displayNoSchedulesMessage(t,!1);return}i=i||"";i?(i=="sort-by-time"&&(r.SchedulesGroup=_.sortBy(r.SchedulesGroup,function(n){return n.DepartureDateTime})),i=="sort-by-price"&&(r.SchedulesGroup=_.sortBy(r.SchedulesGroup,function(n){return n.OnlineFares.LowestFareAverage})),i=="sort-by-speed"&&(r.SchedulesGroup=_.sortBy(r.SchedulesGroup,function(n){return moment.duration(n.Duration).asSeconds()}))):n(t).find(".sort-results-btn.active").each(function(){n(this).is(".sort-by-time")&&(r.SchedulesGroup=_.sortBy(r.SchedulesGroup,function(n){return n.DepartureDateTime}));n(this).is(".sort-by-price")&&(r.SchedulesGroup=_.sortBy(r.SchedulesGroup,function(n){return n.OnlineFares.LowestFareAverage}));n(this).is(".sort-by-speed")&&(r.SchedulesGroup=_.sortBy(r.SchedulesGroup,function(n){return moment.duration(n.Duration).asSeconds()}))});r.SchedulesGroup.length===0?displayNoSchedulesMessage(t,!0,!0):c(r,t)}var e,r,o,u=[],c=function(t,i){var r,u;i.length&&(r=SearchRepo.GetCurrent(),t.DiscountName=Helpers.ShowDiscountText(r),t.DiscountCompanionRemoved=Schedule.getDiscountCompanionRemovedFlag(),i.find(".fare-rows").html(e(t)),n("#discount-headers-template").length>0&&(u=Handlebars.compile(n("#discount-headers-template").html()),i.find(".discount-headers").html(u(t))),n("body").removeClass("fares-open"),h(i),ScheduleFlow.init(t,i))},s=function(t,i){r=n.extend(!0,{},t);i.find(".filter-results-btn.active").each(function(){var t=n(this).attr("data-filter-val");n(this).is(".filter-departuretime .filter-results-btn")&&(r.SchedulesGroup=_.filter(r.SchedulesGroup,function(n){var i=moment(t,"HH:mm a").minutes()+moment(t,"HH:mm a").hours()*60,r=moment(n.DepartureDateTime).minutes()+moment(n.DepartureDateTime).hours()*60;return i<=r}),n(".filter-alert span.leaving-from").text(n(this).text()));n(this).is(".filter-transfer .filter-results-btn")&&(r.SchedulesGroup=_.filter(r.SchedulesGroup,function(n){return n.TransferCount<=parseInt(t,10)}),n(".filter-alert span.transfers").text(n(this).text()));n(this).is(".filter-buslines .filter-results-btn")&&(r.SchedulesGroup=_.filter(r.SchedulesGroup,function(n){return t==="greyhoundonly"?ConfigurationSettings.GreyhoundBusLineCodes.indexOf(n.Carrier)>=0:!0}),n(".filter-alert span.buslines").text(n(this).text()))});f(i)},l=function(t,i){i.find(".filter-results-btn").unbind("click").bind("click",function(r){r.preventDefault();n(this).siblings(".btn-rect").removeClass("active").attr("aria-selected","false");n(this).addClass("active").attr("aria-selected","true");s(t,i);n(".filter-alert").removeClass("hidden")})},a=function(t,i){i.find(".sort-results-btn").unbind("click").bind("click",function(){n(this).closest(".sort-by-list").find(".btn-rect").removeClass("active").attr("aria-selected","false");n(this).addClass("active").attr("aria-selected","true");n(".sort-alert span").text(n(this).text());f(i)})},v=function(t,i){n(".select-sort-results").on("selectmenuchange",function(){var t=n(this).find("option:selected").val(),r=n(this).find("option:selected").attr("data-sort-by-desc");f(i,t);n("#ariaSpeech").attr("aria-live","polite").text("Results updated. Sorted by "+r)})},y=function(){n(".filter-results").mobCollapse({panel:".filter-lists",button:".filter-toggle-btn",mobileonly:!1,hidetoggleOnDesk:!1});n(".filter-results").on("panelClosed",function(){n(".sort-results").removeClass("pos-absolute")});n(".filter-results").on("panelOpen",function(){n(".sort-results").addClass("pos-absolute");n(".sort-by-list").fadeOut("fast");n(".sort-by-btn").removeClass("active")});n(".sort-results").on("panelOpen",function(){n(".sort-results").removeClass("pos-absolute");n(".filter-lists").fadeOut("fast");n(".filter-toggle-btn").removeClass("active")});n(".sort-by-btn").unbind("click").bind("click",function(t){t.preventDefault();n(".sort-by-list").toggle()})},h=function(r){var f,e,s=function(t,r,u){var s="925x280",a,f,o;if(ResponsiveBootstrapToolkit.is("md")||ResponsiveBootstrapToolkit.is("lg")){var h=n(document.getElementById(u+r.ScheduleKey)),c="540",l="1280",e="";h.closest(".itinerary")&&(a=h.closest(".itinerary").find(".col-md-8"),f=a.outerHeight(),e=f>l?l:f<c?c:f);o="344";e>0&&o>0&&(s=o+"x"+e)}r.Stops=t.Stops;i.init({schedule:r,size:s,mapDivId:u+r.ScheduleKey})},h=function(n,t){var i=CachingClientFactory.GetClient("schedules/"+n+"/details");i.GetData({includeStopDetails:!0},t,null)},c=function(n){var t=AugmentStopData(n);return n.showOtherBusLines=t.showOtherBusLines,n.Stops=t.Stops,n.StopsKey=GenerateStopsKey(n.Stops),n},a=function(t){var i=n(document.getElementById("stops-"+t.ScheduleKey)),r=function(r){s(r,t,"");r=c(r);var u=Handlebars.compile(n("#stops-template").html());i.replaceWith(u(r))};i.length>0&&h(t.ScheduleKey,r)},l=function(i,r){if(i.parent(".table-ecom").parent(".fare-header").next(".fare-wrapper").length!==0)if(i.find("span.sold-out").length>0&&i.parent(".table-ecom").parent(".fare-header").next(".fare-wrapper").find(".table-fares-online .fare-box > a").css("cursor","default"),i.find("span.purchase-unavailable").length>0&&i.parent(".table-ecom").parent(".fare-header").next(".fare-wrapper").find(".table-fares-online .fare-box > a").css("cursor","default"),i.is(".fare-open"))n("body").removeClass("fares-open"),i.parent(".table-ecom").parent(".fare-header").next(".fare-wrapper").slideUp().attr("aria-hidden","true"),i.removeClass("fare-open").attr("aria-expanded","false");else{f&&(f.slideUp(),f.prev().find(".fare-row-body").removeClass("fare-open").attr("aria-expanded","false"),n("body").removeClass("fares-open"));f=i.parents(".fare-header").next(".fare-wrapper");e=i.find(".trip-details");i.parent(".table-ecom").parent(".fare-header").next(".fare-wrapper").slideDown(function(){t.ScrollToTopOfPage(e);i.parents(".fare-row").find(".table-fares-online .best-fare a").focus()}).attr("aria-hidden","false");i.parents(".fare-header").next(".fare-wrapper").slideDown();i.addClass("fare-open").attr("aria-expanded","true");n("body").removeClass("sticky-thead-on").addClass("fares-open");var o=i.closest("section").attr("data-schedulekey"),s=getScheduleByKey(u,o);s&&(ConfigurationSettings.ShowStops?a(s):n(document.getElementById(o)).html("<h3>Map currently unavailable<\/h3>"));r&&t.ScrollToTopOfPage(i.find(".trip-details"))}};n(".map-route-mobile").mobCollapse({panel:".toggled-panel-fare",button:".toggle-btn-fare",mobileonly:!0,hidetoggleOnDesk:!0,closeOnClickout:!0});r.find(".fare-row .table-ecom .fare-row-body").unbind("click").bind("click",function(){l(n(this),!0)}).bind("keydown",function(t){var i=t.which;(i===13||i===32)&&n(this).click()});r.find(".view-fares-itinerary").unbind("click").bind("click",function(){l(n(this).closest(".fare-row-body-variant"),!0)}).bind("keydown",function(t){var i=t.which;(i===13||i===32)&&n(this).click()});n(".table-fares").each(function(){var t=n(this),f=t.find(".offline-toggle-btn"),e=t.find(".table-fares-offline > table"),i=t.find(".table-fares-online > table"),r,u;f.unbind("click").bind("click",function(r){r.preventDefault();var u=n(this).find(".txt").text(),f=n(this).find(".txt").attr("data-text-swap");n(this).find(".txt").text(f);n(this).find(".txt").attr("data-text-swap",u);t.is(".offline-on")?(t.removeClass("offline-on"),n(this).attr("aria-expanded","false"),i.find(".fare-box").not(".best-fare").show().attr("aria-hidden","false"),i.animate({width:"480px"},function(){t.removeClass("offline-on")})):(t.addClass("offline-on"),n(this).attr("aria-expanded","true"),i.animate({width:"165px"},function(){i.find(".fare-box").not(".best-fare").hide().attr("aria-hidden","true")}))});t.is(".offline-on")&&(i.animate({width:"165px"},function(){i.find(".fare-box").not(".best-fare").hide()}),r=n(this).find(".txt").text(),u=n(this).find(".txt").attr("data-text-swap"),n(this).find(".txt").text(u),n(this).find(".txt").attr("data-text-swap",r))});n("td.fare-price.clickable").unbind("click").bind("click",function(t){t.preventDefault();n(".selected-fare").hide();n(".fare-price").show();n("td.fare-type").removeClass("opacity");var i=n(this).attr("data-fare-type"),u=n(this).closest("tbody").find(".fare-price"),r=n(this).closest("tbody").find("[data-selected-fare-type='"+i+"']");n("td.fare-type").not("[data-fare-type-heading='"+i+"']").addClass("opacity");u.hide();r.attr("aria-hidden","false").removeClass("hidden").show(0,function(){r.find("h3").focus()})}).bind("keydown",function(t){var i=t.which;(i===13||i===32)&&n(this).click()});n(".clickable-fare").unbind("click").bind("click",function(t){if(t.preventDefault(),o=n(this),n(".fare-type").removeClass("opacity"),!n(this).hasClass("unavailable")){n(".selected-fare").hide();var i=n(this).attr("data-fare-type"),r=n(this).closest(".fare").find("[data-selected-fare-type='"+i+"']");n(this).closest(".fare").find(".clickable-fare").attr("tabindex","-1");n(".fare-type").not('[data-fare-type-heading="'+i+'"]').addClass("opacity");r.attr("aria-hidden","false").removeClass("hidden").show("fast").promise().done(function(){r.focus()})}}).bind("keydown",function(t){var i=t.which;t.stopImmediatePropagation();(i===13||i===32)&&(t.preventDefault(),n(this).click())});n(".show-all-fares").unbind("click").bind("click",function(t){t.preventDefault();pageGlobal.currentSchedule.ReturnResponse||n(".fare-type").removeClass("opacity");o.focus().promise().done(function(){n(".selected-fare").hide();n(".clickable-fare").attr("tabindex","0")})}).bind("keydown",function(t){var i=t.which;t.stopImmediatePropagation();(i===13||i===32)&&(t.preventDefault(),n(this).click())});n("#explore-fare-types-modal").on("shown.bs.modal",function(){n(this).focus()});n(".view-all-fares").unbind("click").bind("click",function(t){t.preventDefault();var f=n(this).attr("data-label-view"),e=n(this).attr("data-label-hide"),o=n(this).attr("data-aria-label-view"),s=n(this).attr("data-aria-label-hide"),u=n(this).closest(".fare").find(".book-economy"),i=n(this),r=i.closest(".fare").find(".fares");r.slideToggle().promise().done(function(){r.is(":visible")?u.slideUp().promise().done(function(){i.text(e).attr("aria-label",s).addClass("expanded").attr("aria-expanded",!0);n("body").addClass("itinerary-open");r.find("[id^='dialogheading']").focus()}):(u.slideDown().promise().done(function(){}),i.text(f).attr("aria-label",o).removeClass("expanded").attr("aria-expanded",!1),n("body").removeClass("itinerary-open"))})});n(".view-itinerary").unbind("click").bind("click",function(t){var i,f,e,o,a;t.preventDefault();var l=n(this),v=n(this).parent(".action"),y=n(this).attr("data-schedulekey"),r=n(this).closest(".fare").find(".itinerary");l.hasClass("mobile-itinerary")?r.find("td").attr("colspan",2):r.find("td").attr("colspan",6);p(r,l,v);i=n(this).closest(".fare").attr("data-schedulekey");f=getScheduleByKey(u,i);f&&(e="map-cond-",ConfigurationSettings.ShowStops?(o=n(document.getElementById("stops-cond-"+i)),a=function(t){var l=function(n){for(var e,u,c=function(n){var i="",t,r,u,e,o,f;if(n.StationLocation){for(t=n.StationLocation,r=function(n,t,i){return t&&(n?n+=i+t:n=t),n},u=1;u<5;u++)e="StreetAddress"+u,o=t[e]?t[e].toString():"",i=r(i,o,"<br />");f=r(t.City,t.StateAbbreviation,", ");f=r(f,t.ZipCode," - ");i=r(i,f,",<br />")}return i},o=[],i=null,s=null,r=0;r<n.Stops.length;r++){var t=n.Stops[r],f=!1,h=!0,l=moment.duration(t.Duration);(t.IsTransfer||r===0||r===n.Stops.length-1||l.asMinutes()>ConfigurationSettings.RestStopDurationThreshold)&&(f=!0,t.ShowScheduleNumber=Boolean(!t.ArrivalTime),t.IsTransfer&&(t.IsFirstTransfer?(h=!1,f=!1,s=t.ArrivalTime):(t.ArrivalTime=s,e=moment(t.ArrivalTime,"h:mm a"),u=moment(t.LeavingTime,"h:mm a"),u.isBefore(e)&&u.add(1,"days"),t.Duration=moment.utc(u.diff(e)).format("HH:mm:ss"))));f?(i&&t.IsTransfer&&(i.NextTransferAt=t.StationName,i.NextTransferSchedule=t.ScheduleNumber),t.Address=c(t),t.Stops=[],o.push(t),i=t):h&&i.Stops.push(t)}n.Stops=o},u,h;t=c(t);l(t);u=Handlebars.compile(n("#stops-template-condensed").html());o.replaceWith(u(t)).promise().done(function(){r.find(".itinerary-stops").focus()});handleTooltips();u=Handlebars.compile(n("#stop-types-template").html());h=document.getElementById("stop-types-cond-"+i);n(h).html(u(t));n(".show-stops").unbind("click").bind("click",function(t){t.preventDefault();var i=n(this).parent("div").find(".tranfer-stops"),r=n(this).find(".icon"),u=n(this);i.toggle("fast",function(){i.is(":visible")?(r.removeClass().addClass("icon icn-050closeorange-sml"),u.attr("aria-expanded",!0)):(r.removeClass().addClass("icon icn-046openorange-sml"),u.attr("aria-expanded",!1))})});s(t,f,e)},o.length>0&&h(i,a)):n(document.getElementById(e+i)).html("<h3>Map currently unavailable<\/h3>"))}).bind("keydown",function(t){var i=t.which;t.stopImmediatePropagation();(i===13||i===32)&&(t.preventDefault(),n(this).click())});n(".back-to-fares").unbind("click").bind("click",function(t){t.preventDefault();var i=n(this),r=i.closest(".fare").find(".clickable-fare").first();r.focus()})},p=function(t,i,r,u){function s(){i.text(e).addClass("expanded").attr("aria-expanded",!0);r.addClass("expanded");n("body").addClass("itinerary-open");o&&i.attr("aria-label",l)}function h(){i.text(f).removeClass("expanded").attr("aria-expanded",!1);r.removeClass("expanded");n("body").removeClass("itinerary-open");o&&i.attr("aria-label",c)}var f,e;if(u=u||!1,i.hasClass("view-all-fares"))f="View all fares",e="Hide all fares";else var f="View Itinerary",e="Hide Itinerary",o=!0,c=i.attr("data-label-view"),l=i.attr("data-label-hide");t.toggle("fast",function(){t.is(":visible")?u?u.hide("fast",function(){s()}):s():u?u.show("fast",function(){h()}):h()})},w=function(){var t=n(window).width();n(window).resize(function(){n(window).width()!=t&&(n(".itinerary").is(":visible")&&(n(".itinerary").hide(),n(".view-itinerary").text("View Itinerary").removeClass("expanded").attr("aria-expanded",!1),n(".action").removeClass("expanded")),t=n(window).width())})},b=function(t,i){u=t.SchedulesGroup;e=Handlebars.compile(n("#schedule-fare-row").html());k(i,u,t.IsRoundTrip);y();h(i);s(t,i);r=n.extend(!0,{},t);l(t,i);a(t,i);v(t,i);w()},k=function(t,i,r){var o={Earliest:"",Cheapest:"",Fastest:"",IsRoundTrip:r},e,u,c,l;if(i.length>0){var s=i[0].DepartureDateTime,f=-1,h=i[0].Duration;for(e=0;e<i.length;e++)u=i[e],s>u.DepartureDateTime&&(s=u.DepartureDateTime),u.LowestFareAverage!==undefined&&(f===-1||f>u.OnlineFares.LowestFareAverage)&&(f=u.OnlineFares.LowestFareAverage),moment.duration(h).asSeconds()>moment.duration(u.Duration).asSeconds()&&(h=u.Duration);f===-1&&(f="N/A");o={Earliest:s,Cheapest:f,Fastest:h,IsRoundTrip:r}}c=Handlebars.compile(n("#sort-button-template").html());t.find(".sort-by-list").html(c(o));l=Handlebars.compile(n("#sort-select-template").html());t.find(".sort-results").find(".select").html(l(o));Accessibility.initSelect(t.find(".sort-results").find("select"))};return{init:b}},ScheduleSummaryBar=function(n){"use strict";var t=n(".summary-bar"),u=function(){t&&(t.before('<span class="sb-overlay hidden" aria-hidden="true"><\/span>'),t.find(".sb-trigger").unbind("click").bind("click",function(u){u.preventDefault();t.is(".sb-active")?i(n(this)):r(n(this))}),f(t),Accessibility.initSelect(n("#sb-change-faretype")))},i=function(i){t.removeClass("sb-active");t.prev(".sb-overlay").addClass("hidden");n("body").removeClass("summary-bar-on");n(i).attr("aria-expanded","false");n(".sb-body").attr("aria-hidden","true")},r=function(i){t.addClass("sb-active");t.prev(".sb-overlay").removeClass("hidden");n("body").addClass("summary-bar-on");n(i).attr("aria-expanded","true");n(".sb-body").attr("aria-hidden","false")},f=function(t){t.find("form.ff-search").each(function(){n(this).data("serialized",n(this).serialize())}).on("change input",function(){n(this).find("#update-search-btn").attr("disabled",n(this).serialize()==n(this).data("serialized")).removeClass("disabled")}).find("#update-search-btn").addClass("disabled").attr("disabled",!0)},e=function(){var t=n("#summarybar-schedule"),i=pageGlobal.scheduleSelection.OutgoingFareType;t.find(".sb-faretypes").find(".sb-popover").removeClass("hidden");t.find("#sb-change-faretype").prop("disabled",!1).selectmenu("refresh");n("#sb-change-faretype").val(i);Accessibility.refreshSelect(n("#sb-change-faretype"));PopoverCustom.init()},o=function(t,i){n("#summarybar-schedule").addClass("outgoing-selected");var r=moment(t);n(".sb-outgoing .sb-trip-date .sb-day").html(r.format("MMM D YYYY"));n(".sb-outgoing .sb-trip-date .sb-time").html(r.format("h:mm a"));n("#summarybar-totalfare").html("$"+i.toFixed(2))};return{init:u,setupFareSelect:e,showSummaryBar:r,hideSummaryBar:i,updateSummary:o}}($gh,Ghound),ScheduleSelector=function(n,t){"use strict";var i=function(){var r=[fareTypes.Economy,fareTypes.EconomyExtra,fareTypes.Flexible],f=fareTypes.OfflineEconomy,u,t,i;for(f.Name=offlineFareHeader,r.push(f),u=0;u<r.length;u++){t=r[u];for(i in t)t.hasOwnProperty(i)&&(t[i]=t[i].toString().replace("(","<br />("),t[i]=t[i].toString().replace(" - ",""))}var e=n("#explore-fare-types-modal-placeholder"),o=n("#fare-types-modal-template").html(),s=Handlebars.compile(o);e.html(s(r));MobileCarousels.init()},r=function(){var r,u,f,e,o;window.pageGlobal={};r=SearchRepo.GetCurrent();r?(u=new Date,u.setHours(0,0,0,0),f=new Date(r.departOn),u>f&&(window.location.href="/"),pageGlobal.fareObj=r,e=new ScheduleCalendar(n,t),e.init(ResponsiveBootstrapToolkit,n("#outgoing-trip .schedule-calendar-wrapper"),new Date(r.departOn)),r.HasWheelchairTraveler()===!1?($gh("#travelonwchair").attr("checked",!1),$gh("#travelonwchair").parent().removeClass("checked")):($gh("#travelonwchair").attr("checked",!0),$gh("#travelonwchair").parent().addClass("checked")),$gh("#outgoing-selected-date").length>0&&$gh("#outgoing-selected-date").text(moment(r.departOn).format("MMMM Do YYYY")),$gh("#soldout-outgoing-selected-date").length>0&&$gh("#soldout-outgoing-selected-date").text(moment(r.departOn).format("MMMM Do")),o={PassengerTotal:r.GetTotalPassengers(),Search:r},Helpers.BindAndShow("summarybar-schedule",o),i(),ScheduleSummaryBar.init()):window.location.href="/"};return{init:r}}(jQuery,Ghound),ScheduleSelectorPod=function(n){"use strict";var t=function(){var r=[fareTypes.Economy,fareTypes.EconomyExtra,fareTypes.Flexible],f=fareTypes.OfflineEconomy,u,t,i;for(f.Name=offlineFareHeader,r.push(f),u=0;u<r.length;u++){t=r[u];for(i in t)t.hasOwnProperty(i)&&(t[i]=t[i].toString().replace("(","<br />("),t[i]=t[i].toString().replace(" - ",""))}var e=n("#explore-fare-types-modal-placeholder"),o=n("#fare-types-modal-template").html(),s=Handlebars.compile(o);e.html(s(r));MobileCarousels.init()},i=function(){var n,i;Cookies.remove("passengerDetails");n=SearchRepo.GetCurrent();n&&(n.HasWheelchairTraveler()===!1?($gh("#travelonwchair").attr("checked",!1),$gh("#travelonwchair").parent().removeClass("checked")):($gh("#travelonwchair").attr("checked",!0),$gh("#travelonwchair").parent().addClass("checked")),$gh("#outgoing-selected-date").length>0&&$gh("#outgoing-selected-date").text(moment(n.departOn).format("MMMM Do YYYY")),$gh("#soldout-outgoing-selected-date").length>0&&$gh("#soldout-outgoing-selected-date").text(moment(n.departOn).format("MMMM Do")),i={PassengerTotal:n.GetTotalPassengers(),Search:n},Helpers.BindAndShow("summarybar-schedule",i),t(),ScheduleSummaryBar.init())};return{init:i}}(jQuery,Ghound),ScheduleTripSummary=function(n){"use strict";var r=function(){n(".ff-summary-travel-edit").click(function(){return n("html, body").animate({scrollTop:0},"slow"),n("#schedule-fare-search").focus(),!1})},t=function(n){var t=(n.val().length+1)*9+"px";n.width(t)},i=function(){n(".sticky-schedule-selector #fromLocation, .sticky-schedule-selector #toLocation").each(function(){t(n(this));n(this).on("keydown",function(){t(n(this))}).on("keyup",function(){t(n(this))}).on("keypress",function(){t(n(this))})})},u=function(){n("form.ff-search").each(function(){n(this).data("serialized",n(this).serialize())}).on("change input",function(){n(this).find("#update-search-btn").attr("disabled",n(this).serialize()==n(this).data("serialized")).removeClass("btn-inactive")}).find("#update-search-btn").addClass("btn-inactive").attr("disabled",!0)},f=function(){$gh(".mobile-collapse").mobCollapse({panel:".toggled-panel",button:".toggle-btn",mobileonly:!0,hidetoggleOnDesk:!0,closeOnClickout:!1})},e=function(){f();r();u(),function(n,t){(t.is("md")||t.is("lg"))&&i();n(window).bind("resize",function(){t.is("md")||t.is("lg")?i():n("#fromLocation,#toLocation").css("width","100%")})}(jQuery,ResponsiveBootstrapToolkit)};return{init:e}}(jQuery,Ghound),ScheduleSummary=function(n){"use strict";var t=function(){n(".summary-collapse").mobCollapse({panel:".toggled-panel",button:".toggle-btn",mobileonly:!1,hidetoggleOnDesk:!1,closeOnClickout:!1});handleTooltips()};return{init:t}}(jQuery,Ghound),Schedule=function(){"use strict";var n=function(){var t="",n=SearchRepo.GetCurrent();return n.DiscountCompanionRemoved==="true"&&(t="true",n.DiscountCompanionRemoved="",SearchRepo.Save(n)),t};return{getDiscountCompanionRemovedFlag:n}}();$gh("#schedule-fare-search").change(function(){$gh("#update-search-btn").removeClass("disabled");$gh("#update-search-btn").removeClass("btn-tertiary")});PaymentPageJs=function(n,t,i){"use strict";function rt(){var u=n("#cardHolderFirstName"),f=n("#cardHolderLastName"),i,r,t;n(".card-holder-name").val(n("#primary-card-holder").val());n("#primary-card-holder").val()==="other"?(t=Cookies.getJSON("passengerDetails"),i=t!==undefined&&t!==null?{firstName:t.cardHolderFirstName,lastName:t.cardHolderLastName}:{firstName:"",lastName:""},r=!1,n("#storedCardDiv").is(":visible")||n(".card-holder-inputs").css("display","")):(i=JSON.parse(n("#primary-card-holder").val()),r=!0,n(".card-holder-inputs").css("display","none"));u.val(i.firstName);f.val(i.lastName);u.prop("disabled",r);f.prop("disabled",r);it();n("#cardHolderFirstName").parent().hasClass("error")&&u.valid();n("#cardHolderLastName").parent().hasClass("error")&&f.valid()}function a(n,t,i){var u,r;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString()):u="";document.cookie=encodeURIComponent(n)+"="+encodeURIComponent(t)+u+"; path=/"}function ct(){n(".edit-passenger-details, fieldset.contact").removeClass("hidden");n("#passenger-details .details-summary").addClass("hidden");n(".edit-details").hide().closest(".edittable").addClass("active")}function lt(t){var e=n(".toggle-btn-rw"),i=n(".toggle-row"),r=n(".toggled-panel-rw"),u=n(".rr-join-panel"),o=n(".rr-cancel"),s=n(".rr-signup-expand-btn"),f=n(".rr-signin-text");t.hasClass("rr-signup-expand-btn")?(n("body").addClass("rr-join-panel-open"),e.click(),i.removeClass("row").addClass("col-md-4"),f.removeClass("col-md-6").addClass("col-md-10"),r.removeClass("row").addClass("col-md-8"),u.parent("div").addClass("col-md-12").removeClass("col-md-5 col-md-offset-1").attr("aria-expanded","true"),t.attr("aria-labelledby","").attr("aria-expanded",!0),o.attr("aria-expanded",!0)):t.hasClass("rr-cancel")&&(n("body").removeClass("rr-join-panel-open"),i.removeClass("col-md-4").addClass("row"),f.removeClass("col-md-10").addClass("col-md-6"),r.removeClass("col-md-8").addClass("row"),u.parent("div").removeClass("col-md-12").addClass("col-md-5 col-md-offset-1").attr("aria-expanded","false"),t.attr("aria-expanded",!1),s.attr("aria-labelledby","signInDesc").attr("aria-expanded",!1))}function at(){u.Total=u.FareSubtotal+u.Tax;var n=0;u.Fees.forEach(function(t){n+=t.Amount});u.Total+=n;d.priceInformationReturned(u)}function li(){var y;if(roadRewardsUser){var e=n("#cardDetails"),h="stored-card-data",p="session-expired",t,i,r,u,f,o=function(){e.removeClass(h)},s=function(){e.find("#new-card-form .loggedin-only").addClass("hidden")},l=function(t){var i,r,u;v.TokenCount=t.length;t.length===0?o():(v.Tokens=t,i=function(){var t=n("#storedCard option:selected"),i=t.attr("data-card-type"),u=t.attr("data-card-expired"),r=n("#storedCardExpiry-error");u==="true"?(r.removeClass("hidden").attr("aria-hidden",!1),n('button[data-id="storedCard"]').parent(".btn-group").addClass("error")):(r.addClass("hidden").attr("aria-hidden",!0),n('button[data-id="storedCard"]').parent(".btn-group").removeClass("error"));n("#cardType").val(i);n(".storedCardIcon").attr("src","/Content/Images/icons/payments/"+i+".png").removeClass("hidden");it()},e.addClass(h),r=n("#storedCardOptions").html(),u=Handlebars.compile(r),n("#storedCard").html(u(t)),n("#storedCard").storedCardSelect({select:function(){n(this).storedCardSelect("enhanceAccessibility")},change:function(){n(this).storedCardSelect("enhanceAccessibility");i()}}).storedCardSelect("refresh").storedCardSelect("enhanceAccessibility"),i(),k(),t.length>=ConfigurationSettings.MaxSavedTokens&&s())},b=function(n){if(n.Code==="MTEXP"){var t=c,i=w;t.addClass(p);g(i,t);v.TokenCount=n.Response.TokenCount;v.TokenCount>=ConfigurationSettings.MaxSavedTokens&&s()}else o()};n("#btnDeleteStoredCard").click(function(){var e=n("#storedCard option:selected"),o=e.val();t=n("#cardSelectArea");i=n(".confirmDelete").find(".notification-box");r=n("#storedCardActionAlerts");u=n(".cardDeleteSpinner");f=n(".deleteNotification");t.addClass("hidden");i.removeClass("hidden");d(o);r.html("").html(deleteConfirm)});var k=function(){n(".btnCancelDelete").click(function(){i.addClass("hidden");t.removeClass("hidden")})},d=function(t){n(".btnConfirmDelete").click(function(){u.removeClass("hidden");nt(t)})},a=function(){n(".closeNotification").click(function(n){n.preventDefault();f.addClass("hidden").find("p").addClass("hidden")})},nt=function(n){var e=function(n){u.addClass("hidden");n.length>0?(l(n),i.addClass("hidden"),t.removeClass("hidden"),f.removeClass("hidden").find(".deleteSuccess").removeClass("hidden"),a(),r.html("").html(deleteSuccess)):showNewCardForm()},o=function(){u.addClass("hidden");i.addClass("hidden");t.removeClass("hidden");f.removeClass("hidden").find(".deleteError").removeClass("hidden");a();r.html("").html(deleteError)},s=ApiClientFactory.GetClient("paymenttokens/deleteToken/"+encodeURIComponent(roadRewardsUser.memberKey),ConfigurationSettings.CommonApiUrl,!1);s.GetData({deleteTokenKey:n},e,o)};typeof ssoAgent!="undefined"?(o(),s()):(y=ApiClientFactory.GetClient("paymenttokens/getToken/"+encodeURIComponent(roadRewardsUser.memberKey),ConfigurationSettings.CommonApiUrl,!1),y.GetData(null,l,b))}}function fi(n,t){while(n.options.length>t)n.remove(n.options.length-1)}function vt(t){var u=n(t).val(),i=n("#cardHolderPhone"),e,r,f;i.length==0&&(i=n("#passenger-1-cardHolderPhone"));u==o?(i.attr("data-rule-foreignphone",o),i.attr("data-msgfor-foreignphone",i.attr("data-msg-phoneus"))):(e=n("#cardCountry").val(),ConfigurationSettings.NATPCountries.indexOf(e)!=-1?i.attr("data-rule-foreignphone","NATP"):i.attr("data-rule-foreignphone","OTHER"),i.attr("data-msgfor-foreignphone",i.attr("data-phoneforeign-msg")));window.EUCountries.indexOf(u)>=0?n("#optInArea").show():n("#optInArea").hide();n("#optInEmail").prop("checked",!1);statesByCountry[u]?(r=statesByCountry[u],n("#cardHolderZipPlaceholder").html(r.ZipLabel),n("#cardHolderZip-label").html(r.ZipLabel),n("#cardHolderState").parent().removeClass("hide"),f=n("#cardHolderState")[0],fi(f,1),dt(f,r.List),n("#cardHolderState .label").text(r.stateLabel),Accessibility.refreshSelect(n("#cardHolderState")),n("#intRegion").parent().addClass("hide")):(n("#cardHolderZipPlaceholder").html("Postal Code"),n("#cardHolderZip-label").html("Postal Code"),n("#cardHolderState").parent().addClass("hide"),n("#intRegion").parent().removeClass("hide"));Accessibility.refreshSelect(n("#cardCountry"))}function vi(){var t=n("#cardCountry")[0];fi(t,0);dt(t,countries);n(t).val(o);vt(t);n(t).on("selectmenuchange",ai)}function yi(t){var i=t.passengerInfo,r,u;n.each(i,function(t){var u,f,e,o,r;i[t].firstName!==""&&(u=n(".row.passenger .first-name").eq(t),u.val(i[t].firstName),f=n(".row.passenger .last-name").eq(t),f.val(i[t].lastName),e=n(".row.passenger .road-rewards").eq(t),o=ti.decode(i[t].roadRewardId),e.val(o),r=n(".row.passenger .sp-needs-options").eq(t),r.val(i[t].specialNeed),Accessibility.refreshSelect(r))});kt();bt();g(w,c);t.cardHolderFirstName!==""&&n("#cardHolderFirstName").val(t.cardHolderFirstName);t.cardHolderLastName!==""&&n("#cardHolderLastName").val(t.cardHolderLastName);t.cardHolderCountry!==""&&(r=n("#cardCountry")[0],n(r).val(t.cardHolderCountry),vt(r));t.cardHolderAddress!==""&&n("#cardHolderAddress").val(t.cardHolderAddress);t.cardHolderAddress2!==""&&n("#cardHolderAddress2").val(t.cardHolderAddress2);t.cardHolderZip!==""&&n("#cardHolderZip").val(t.cardHolderZip);t.cardHolderState!==""&&(u=n(".selectmenu"),u.val(t.cardHolderState),n(".selectmenu").selectmenu("refresh"),Accessibility.refreshSelect(n(".selectmenu")));t.intRegion!==""&&n("#intRegion").val(t.intRegion);t.cardHolderCity!==""&&n("#cardHolderCity").val(t.cardHolderCity);t.cardHolderphone!==""&&n("#cardHolderPhone").val(t.cardHolderphone);t.passengeremail!==""&&n("#cardHolderEmail").val(t.passengeremail);t.eticket&&n("#ticket-type-eticket").iCheck("check");t.printAtHome&&n("#ticket-type-print").iCheck("check");t.willCall&&n("#ticket-type-collect").iCheck("check");t.termsAndConditions&&n("#termsAndConditions").iCheck("check");t.optInEmail&&n("#optInEmail").iCheck("check")}function yt(n,t){for(var r=0,i=0;i<n.length;i++)n[i]===t&&r++;return r}function pt(n,t){var i,f,e,r,u,s;if(n&&(i=o,t==l&&(i=l),statesByCountry[i]))for(f=statesByCountry[i],e=Object.keys(f.List),r=0;r<e.length;r++)if(u=e[r],s=f.List[u],u.toUpperCase()===n.toUpperCase()||s.toUpperCase()===n.toUpperCase())return u;return undefined}function gi(){pi();var c=function(){f.IsPastETicketCutoffTime&&!f.ETicketOnly&&(window.location=ConfigurationSettings.TooLateForOnlinePurchase);n("input.road-rewards").each(function(){var t=n(this);n(this).rules("add",{required:!1,number:t.val()!=t.attr("placeholder")})});var t=n("#ff-payment").valid();return p=!0,n(".whchair-spaces-info").addClass("hidden"),ut(),t},a=function(){n("[placeholder]").each(function(){var t=n(this);t.val()==t.attr("placeholder")&&t.val("")});var t=Helpers.ParseForm("ff-payment");return t["payment-type"]==="CreditCard"&&n("#storedCardDiv").is(":visible")&&(t["payment-type"]="SavedPayment"),t["payment-type"]==="SavedPayment"&&n("#storedCard").is(":disabled")&&(t.storedCard=n("#storedCard").val()),t},y=function(n,t,i){var u=n.cardEXP.split("/"),f=0,r=AjaxClientFactory.GetClient(ConfigurationSettings.TokenizationUrl),e={paymentGatewayInformation:{apiOperation:"TOKENIZE"},paymentInformation:{cardDetails:{cardExpireMonth:u[0],cardExpireYear:u[1],cardNumber:n.cardNumber}},timeStamp:ConfigurationSettings.EncryptedDateStamp},o=function(n){var u=JSON.parse(n),s,h,c,l;u.responseData?i(u):(s=!0,h=u.code?u.code:0,h===457&&(f++,f<2&&(s=!1,r.PostData(e,o,t))),s&&(c=u.msg?u.msg:"Unknown error",l=Helpers.GetErrorObject("Error",r.GetLastRequestedUrl,"TS"+h,c),t(l)))};r.PostData(e,o,t)},i=function(){Cookies.remove("scheduleData");SchedulesRepo.ClearCachedSchedules();var n=SearchRepo.GetCurrent();n.discountType&&n.discountType==="roadRewards"&&delete n.discountType;delete n.discountCode;SearchRepo.Save(n)},w=function(n){n===null&&(n={});n.Message||(n.Code||(n.Code="700000"),n.Message="Unknown error");t(n.Code,n.Message)},t=function(n,t,r){var u=function(t){var i=ConfigurationSettings.PaymentErrorUrl;r==="Cash"&&(i=ConfigurationSettings.PayNearMeErrorUrl);t!=null&&t.toString().indexOf("No seats available")!==-1&&(i=ConfigurationSettings.NoSeatsAvailableUrl);AgentPresent&&alert(t);n?Helpers.RedirectToError(n,i):Helpers.RedirectToError(t,i)};i();u(t)},e=function(e){var a,p,b,g,nt,k,et,it,rt;SessionTracker.StopTracking();Cookies.remove("passengerDetails");var s={},ut=function(o){var h=0,c=function(){if(h++,h>ConfigurationSettings.MaxReCheckPurchaseStatusCount){t("700101","Transaction Count Exceeded",e["payment-type"]);return}var l=function(o){var v,p,h,w,a,l,g;switch(o.Status){case"Confirmed":try{v=r.discountType;v==="coupon"&&r.discountCode===""&&(v="");var b=JSON.parse(r.originCode).stopCode,k=JSON.parse(r.destinationCode).stopCode,d=f.OutgoingFareType;for(f.ReturnFareType&&(d+=" | "+f.ReturnFareType),p=!1,h=!1,u.ChargeGtoFee?n("#primary-card-holder").val()=="other"?(p=!0,h=!0):roadRewardsUser&&n("#storedCard option:selected").attr("data-card-name")&&!y()&&(p=!0,h=!0):n("#primary-card-holder").val()=="other"?h=!0:roadRewardsUser&&n("#storedCard option:selected").attr("data-card-name")&&!y()&&(h=!0),w={transactionId:o.ConfirmationNumber,transactionAffiliation:s.TicketingMethod,transactionTotal:u.Total,transactionTax:u.Tax,transactionShipping:u.ServiceCharge,transactionProducts:[],book_route_origin:r.originCity,book_route_destination:r.destinationCity,book_route_origin_code:b,book_route_destination_code:k,book_discount_type:v,book_discount_code:r.discountCode,book_rr_offer_type:"",triptype:s.IsRoundtrip?"return":"single",book_delivery_type:s.TicketingMethod,book_service_fee:u.ServiceCharge,book_total_passengers:s.PassengerDetails.length,ticket_type:d,payment_method:s.PaymentType,is_cardholder_traveling:u.ChargeGtoFee==!0?s.PaymentDetails.IsCardHolderTraveling:!h,is_gto_fee_enabled:u.ChargeGtoFee,gto_fee_amount:p==!0?ConfigurationSettings.NonTravelerAdminFee:0,someone_else_paying:h,ETicket_only:u.ETicketOnly},a=tt(!0),l=0;l<a.length;l++)w.transactionProducts.push({sku:b+"-"+k+"-"+a[l].PassengerType+"-"+(l+1),name:r.originCity+" to "+r.destinationCity,category:a[l].PassengerType,price:a[l].FareAmount,quantity:1});Cookies.set("confirmedTransaction",JSON.stringify(w))}catch(nt){Helpers.GetErrorObject("Error",null,"000","Payment GA Failed: '"+nt.message+"'")}r.discountType==="roadRewards"&&$gh.ajax({type:"GET",url:"/services/RefreshRoadRewardsProfile/"+r.discountCode.toString(),error:function(){},success:function(){}});i();g=s.PassengerDetails[0].LastName;window.location="confirmation?confirmationnumber="+encodeURIComponent(o.ConfirmationNumber)+"&lastname="+encodeURIComponent(g);break;case"Declined":window.location=ConfigurationSettings.PaymentDeclinedUrl;break;case"Failed":case"Error":o!=null&&o.SystemFailureMessage!=null?t(null,o.SystemFailureMessage,e["payment-type"]):o!=null&&o.Message!=null&&t(null,o.Message,e["payment-type"]);break;default:setTimeout(c,2e3)}},a=function(){setTimeout(c,2e3)},v=ApiClientFactory.GetClient("transactions/"+o.TransactionId+"?count="+h);v.GetData({},l,a)};setTimeout(c,2e3)},d=f.PriceConfirmationParameters;s.RequestId=d.requestId;s.OutboundFareKey=u.OutboundConfirmedFareKey;d.returnFareKey?(s.IsRoundtrip=!0,s.ReturnFareKey=u.ReturnConfirmedFareKey):(s.IsRoundtrip=!1,s.ReturnFareKey="");s.HasSpecialNeeds=e.specialNeeds==="on"?!0:!1;s.PassengerDetails=tt(!1);a=r.discountType;a==="coupon"&&r.discountCode===""&&(a="");s.DiscountType=a;s.DiscountCode=r.discountCode;s.PaymentType=e["payment-type"];var c={SavePayment:!1},ft=function(){var t=[];return n(".passenger").each(function(){if(n(this).find("input[name^=passenger-][name$=-type]").val()!=="Child"){var i=n(this).find(".first-name").val(),r=n(this).find(".last-name").val(),u={firstName:i,lastName:r};t.push(u)}}),t},y=function(){for(var i,f,e=n("#storedCard option:selected").attr("data-card-name"),r=ft(),u=!1,t=0;t<r.length;t++)if(i=r[t],f=i.firstName.trim()+" "+i.lastName.trim(),f.toLowerCase()===e.toLowerCase()){u=!0;break}return u};s.PaymentType==="SavedPayment"?(c.IsCardHolderTraveling=u.ChargeGtoFee?y():!0,c.PaymentKey=e.storedCard,p=_.find(v.Tokens,function(n){return n.Key===c.PaymentKey}),c.FirstName=p.FirstName,c.LastName=p.LastName):(e["primary-card-holder"]==="other"?(c.FirstName=e.cardHolderFirstName,c.LastName=e.cardHolderLastName,c.IsCardHolderTraveling=u.ChargeGtoFee?!1:!0):(b=JSON.parse(e["primary-card-holder"]),c.FirstName=b.firstName,c.LastName=b.lastName,c.IsCardHolderTraveling=!0),c.CardNumber=e.cardNumber,c.CardSecurityCode=e.cardCCV,g=e.cardEXP.replace("/","/01/"),c.CardExpiration=moment(g,"MM/DD/YY").endOf("month").format("YYYY-MM-DD"),c.SavePayment=e["save-card"]==="Yes"&&v.TokenCount<ConfigurationSettings.MaxSavedTokens);c.PaymentCardType=e.cardType;e.cardCountry.toUpperCase()!=o&&e.cardCountry.toUpperCase()!=l&&(e.cardHolderState=e.intRegion);c.BillingAddress={AddressLine1:e.cardHolderAddress,AddressLine2:e.cardHolderAddress2,City:e.cardHolderCity,State:e.cardHolderState,Region:e.intRegion,ZipCode:e.cardHolderZip,Country:e.cardCountry.toUpperCase()};e.intRegion||e.cardHolderState||(c.BillingAddress.Region=ot);s.PaymentDetails=c;s.PaymentType==="Cash"&&(s.PayNearMeZip=e["retailer-search-zip"],s.PaymentDetails.FirstName=s.PassengerDetails[0].FirstName,s.PaymentDetails.LastName=s.PassengerDetails[0].LastName,s.PaymentDetails.IsCardHolderTraveling=!0);s.TicketingMethod=e["ticket-type"];s.WillCallPassword=e["ticket-password"];h?(nt=e["passenger-1-cardHolderPhone"].replace(/\D+/g,""),s.ContactDetails={PhoneNumber:nt,EmailAddress:e["passenger-1-cardHolderEmail"],OptedInToMarketingCommunication:Boolean(e.promotions_card==="on")}):s.PaymentType==="CreditCard"||s.PaymentType==="SavedPayment"?s.ContactDetails={PhoneNumber:e.cardHolderPhone.replace(/\D+/g,""),EmailAddress:e.cardHolderEmail,OptedInToMarketingCommunication:Boolean(e.promotions_card==="on")}:(k=e.cashPhone.replace(/\D+/g,""),n("#outsideUSandCanada").prop("checked")&&(k=ConfigurationSettings.DefaultForeignPhone),s.ContactDetails={PhoneNumber:k,EmailAddress:e.cashEmail,OptedInToMarketingCommunication:Boolean(e.promotions==="on")});et=s.ContactDetails.PhoneNumber;s.AgreedToTermsAndConditions=Boolean(!n("#termsAndConditionsArea").is(":visible")||e.termsAndConditions==="on");s.EUUK=window.EUCountries.indexOf(n("#cardCountry").val())>=0?!0:!1;s.EOPTIN=n("#optInEmail").prop("checked");s.RoadRewardsMemberId=roadRewardsUser===null?"":roadRewardsUser.memberId;s.AutoSignupForRoadRewards=!1;s.IovationPayload=e.ioBlackBox;s.IovationPayload||(s.IovationPayload="ioviationpayloadmissing");s.IovationPayload||(s.IovationPayload="ioviationpayloadmissing");it={PurchasesRequest:s};rt=ApiClientFactory.GetClient("purchases");$gh.ajax({type:"GET",url:"/analytics/TriggerGoal/"+paymentGoals.PaymentGoalDepartSchedule});$gh.ajax({type:"GET",url:"/analytics/TriggerGoal/"+paymentGoals.PurchaseGoal});h?$gh.ajax({type:"GET",url:"/analytics/TriggerGoal/"+paymentGoals.PaymentGoalOneClick}):$gh.ajax({type:"GET",url:"/analytics/TriggerGoal/"+paymentGoals.PaymentGoalNonOneClick});f.SelectedSeatNudgeDepartSchedule&&$gh.ajax({type:"GET",url:"/analytics/TriggerGoal/"+paymentGoals.PaymentGoalDepartScheduleWithSeatNudge});f.SelectedSeatNudgeReturnSchedule&&$gh.ajax({type:"GET",url:"/analytics/TriggerGoal/"+paymentGoals.PaymentGoalReturnScheduleWithSeatNudge});f.ReturnDepartureTime!=null&&$gh.ajax({type:"GET",url:"/analytics/TriggerGoal/"+paymentGoals.PaymentGoalReturnSchedule});rt.PostData(it,ut,w)},s=function(i){var s=function(){var t=function(){},n;roadRewardsUser&&!et&&(n=ApiClientFactory.GetClient("account/AgreedToTermsAndConditions","/",!1),n.GetData(null,t,null))},u,r,f,o;try{c()&&(u=i.target,n(u).siblings("img.loader").removeClass("ghidden"),u.disabled=!0,s(),r=a(),ConfigurationSettings.TokenizationEnabled&&r["payment-type"]==="CreditCard"?(f=function(n){t(n.Code,n.Message,r["payment-type"])},o=function(n){r.cardNumber=n.responseData.transaction.cardToken;e(r,i)},y(r,f,o)):e(r,i))}catch(h){}finally{return!1}};n("#btnPay").click(s);n("#btnReserve").click(s)}var u,r,f,ft,v={},gt="",h=!1,et=!1,nt=!1,c=n("#frmReauthenticate"),w=n("#reauthenticate-placeholder"),e=0,y=!1,b=!1,p=!1,k=[],s=0,ni=0,d,ti=new Hashids("xsdref345tg"),o="USA",l="CAN",ot="NONE",st=function(n,t){var r="-",i;return i=n?_.find(t.FareDetails,function(t){return t.PassengerType===n&&t.Count>0}):_.find(t.FareDetails,function(n){return n.Count>0}),i&&(i.Count-=1,r=i.FareAmount.toFixed(2)),r},ii=function(t){var i=function(t){for(var f,c,e,v,i=function(n){var t=0;return n&&(t=parseInt(n)),t},l=n.extend(!0,{},t),o=[],a=[{Type:"Wheelchair",Count:i(r.adultWheelchairs)+i(r.childWheelchairs)+i(r.seniorWheelchairs)},{Type:"Adult",Count:i(r.adults)-i(r.adultWheelchairs)},{Type:"Senior",Count:i(r.seniors)-i(r.seniorWheelchairs)},{Type:"Child",Count:i(r.children)-i(r.childWheelchairs)}],s=[],u,h=0;h<a.length;h++)for(f=a[h],c=0;c<f.Count;c++)u=st(f.Type,t),u==="-"?s.push({Type:f.Type,Count:1}):o.push({FareAmount:parseFloat(u),PassengerType:f.Type,Count:1});for(e=0;e<s.length;e++)v=s[e],u=st(null,t),u!=="-"&&o.push({FareAmount:parseFloat(u),PassengerType:v.Type,Count:1});return l.FareDetails=o,l};u=i(t);d.priceInformationReturned(u)},tt=function(n){for(var i=Helpers.ParseForm("passenger-details :input"),t=1,u=[],r;i["passenger-"+t+"-firstname"]!==undefined;)r={FirstName:i["passenger-"+t+"-firstname"],LastName:i["passenger-"+t+"-lastname"],RoadRewardsId:i["passenger-"+t+"-rr-id"],PassengerType:i["passenger-"+t+"-type"],FareAmount:i["passenger-"+t+"-amount"],SpecialNeeds:i["sp-needs-options-"+t]},!n&&r.PassengerType.indexOf("-Wheelchair")>=0&&(r.PassengerType="Wheelchair"),u[t-1]=r,t++;return u},hi=function(){var i,t,e;if(n("#rewards-container").mobCollapse({panel:".toggled-panel-rw",button:".toggle-btn-rw",mobileonly:!0,closeOnClickout:!1,addButtonTab:!0}),i=parseInt(fareTypes[f.OutgoingFareType].PointsEarned),r.ReturnFareType&&(i+=parseInt(fareTypes[f.ReturnFareType].PointsEarned)),r.discountType==="roadRewards"&&r.discountCode)n("#rr-join-panel").hide();else if(n("#rr-join-panel").show(),roadRewardsUser!==null){var o=Helpers.DistinctSortedRewardsList(),u=o,s=r.GetTotalPassengers();s>1&&o.forEach(function(n){n.Description.toLowerCase()==="companion pass"&&(u=n)});t={FirstName:roadRewardsUser.firstName,RewardCount:u.length,PointsEarned:i};u.length>0?(e=!0,t.RewardItems=u):(e=!1,n("#rr-join-panel").hide());t.HasRewards=e;Helpers.BindAndShow("rewards-container",t);Accessibility.initSelect(n("#rewards-select"));r.discountType==="roadRewards"&&n("#rewards-select").val(r.discountCode);n("#use-reward").click(function(){var t=n("#rewards-select").find(":selected").val();t!==0&&(r.discountType="roadRewards",r.discountCode=t,SearchRepo.Save(r),window.location="schedule")})}else t={PointsEarned:i},n("#rewards-container").show()},ri=function(){var t=[];return n(".passenger").each(function(){if(n(this).find("input[name^=passenger-][name$=-type]").val()!=="Child"){var i=n(this).find(".first-name").val(),r=n(this).find(".last-name").val(),u={firstName:i,lastName:r};t.push(u)}}),t},ui=function(t){var u=[];n(".passenger").each(function(){var t=n(this).find(".first-name").val(),i=n(this).find(".last-name").val(),r=n(this).find(".road-rewards").val(),f=ti.encode(parseInt(r)),e=n(this).find(".sp-needs-options").val(),o={firstName:t,lastName:i,specialNeed:e,roadRewardId:f};u.push(o)});var o=n("#cardHolderFirstName").val(),s=n("#cardHolderLastName").val(),f=n("#primary-card-holder").val(),h=n("#cardCountry").val(),c=n("#cardHolderAddress").val(),l=n("#cardHolderAddress2").val(),a=n("#cardHolderZip").val(),v=n("#cardHolderCity").val(),y=n("#cardHolderState").val(),p=n("#intRegion").val(),w=n("#cardHolderPhone").val(),b=n("#cardHolderEmail").val(),k=n("#ticket-type-eticket").is(":checked"),d=n("#ticket-type-print").is(":checked"),g=n("#ticket-type-collect").is(":checked"),nt=n("#termsAndConditions").is(":checked"),tt=n("#optInEmail").is(":checked"),r=!1,e=!1,i=Cookies.getJSON("passengerDetails");return t?n("#editAddress").css("display")==="none"&&(r=!0):n("#editAddress").css("display")==="none"&&i!==undefined&&i!==null&&(r=i.isCardDetailUpdated),i!==undefined&&i!==null&&(f=i.primaryCardHolder,e=i.isUpgraded),{passengerInfo:u,cardHolderCountry:h,cardHolderAddress:c,cardHolderAddress2:l,cardHolderZip:a,cardHolderState:y,intRegion:p,cardHolderCity:v,cardHolderphone:w,passengeremail:b,eticket:k,printAtHome:d,willCall:g,termsAndConditions:nt,optInEmail:tt,isCardDetailUpdated:r,cardHolderFirstName:o,cardHolderLastName:s,primaryCardHolder:f,isUpgraded:e}},it=function(){if(u.ChargeGtoFee){var t=function(){for(var i,f,e=n("#storedCard option:selected").attr("data-card-name"),r=ri(),u=!1,t=0;t<r.length;t++)if(i=r[t],f=i.firstName.trim()+" "+i.lastName.trim(),f.toLowerCase()===e.toLowerCase()){u=!0;break}return u},i=function(){return n("#primary-card-holder").val()!=="other"},r=function(t){if(t)u.RemoveFee("CardholderNotTraveling"),n(".someone-else-text").removeClass("active");else{var i=Math.max(0,ConfigurationSettings.NonTravelerAdminFee-u.GetFee("WillCall"));u.AddFee("CardholderNotTraveling",i);n(".someone-else-text").addClass("active")}at()};ft=n("#storedCardDiv").is(":visible")?t():i();r(ft)}},ht=function(){nt||(n("#passenger-1-rr-id").val(""),n("#passenger-1-rr-id").change(),nt=!0)},ci=function(){function l(n,t){(n.val()===""||n.val()===n.attr("placeholder"))&&n.val(t);n.data("rrDefault",t)}function i(){var n=ui(!0);a("passengerDetails",JSON.stringify(n),.5);s()}function t(){var n=Cookies.getJSON("passengerDetails"),t;n!==undefined&&n!==null&&(n.isUpgraded||this.id!=="passenger-1-firstname"&&this.id!=="passenger-1-lastname"||v(),n.isUpgraded&&this.id!=="passenger-1-firstname"&&this.id!=="passenger-1-lastname"&&(n.isUpgraded=!1,a("passengerDetails",JSON.stringify(n),.5)));(this.id==="passenger-1-firstname"||this.id==="passenger-1-lastname")&&ht();t=ui(!1);a("passengerDetails",JSON.stringify(t),.5);s()}function v(){var i,t;roadRewardsUser===null&&(t=Cookies.getJSON("passengerDetails"),t!==undefined&&t!==null&&(i={firstName:"",lastName:""},i.firstName=n("#passenger-1-firstname").val().replace(/'/g,"&apos;"),i.lastName=n("#passenger-1-lastname").val().replace(/'/g,"&apos;"),i.firstName!==""||i.lastName!==""?(t.primaryCardHolder=JSON.stringify(i),a("passengerDetails",JSON.stringify(t),.5)):i.firstName===""&&i.lastName===""&&(t.primaryCardHolder="other",t.cardHolderFirstName="",t.cardHolderLastName="",n("#cardHolderFirstName").val(""),n("#cardHolderLastName").val(""),a("passengerDetails",JSON.stringify(t),.5))))}function s(){for(var t,f,i,r="",e=ri(),u=0;u<e.length;u++)t=e[u],t.firstName=t.firstName.replace(/'/g,"&apos;"),t.lastName=t.lastName.replace(/'/g,"&apos;"),f=t.firstName+" "+t.lastName,f!==" "&&(r+="<option value='"+JSON.stringify(t)+"'>"+f+"<\/option>");r+="<option value='other'>Someone else<\/option>";n("#primary-card-holder").html(r);i=Cookies.getJSON("passengerDetails");i!==undefined&&i!==null&&i.primaryCardHolder!==undefined&&(i.primaryCardHolder!==null||i.primaryCardHolder!=="")?n("#primary-card-holder").val(i.primaryCardHolder):n("#primary-card-holder").val(n("#primary-card-holder option:first").val());Accessibility.refreshSelect(n("#primary-card-holder"));rt()}function y(){var t=String.fromCharCode(event.keyCode),n=event.keyCode;[8].indexOf(n)===-1&&(event.target.value=event.target.value.replace(/^([1-9]\/|[2-9])$/g,"0$1/").replace(/^(0[1-9]|1[0-2])$/g,"$1/").replace(/^([0-1])([3-9])$/g,"0$1/$2").replace(/^(0?[1-9]|1[0-2])([0-9]{2})$/g,"$1/$2").replace(/^([0]+)\/|[0]+$/g,"0").replace(/[^\d\/]|^[\/]*$/g,"").replace(/\/\//g,"/"))}var e,p,r;n("#rewards-select").on("selectmenuchange",function(){var t=n("#rewards-select option:selected").val();switch(t){case"noReward":n(".rr-use-reward-btn").prop("disabled",!0);n("#rewards-select").find("option:selected").removeAttr("selected");n("#rewards-select").find("option:first").attr("selected","selected");n(".no-reward").addClass("hide");break;case"selectReward":n(".rr-use-reward-btn").prop("disabled",!0);n(".no-reward").addClass("hide");break;default:n(".rr-use-reward-btn").prop("disabled",!1);n(".no-reward").removeClass("hide")}Accessibility.refreshSelect(n("#rewards-select"))});n("#primary-card-holder").on("selectmenuchange",function(){var i=n("#primary-card-holder").val(),t=Cookies.getJSON("passengerDetails");t!==undefined&&t!==null&&(t.primaryCardHolder=i,i==="other"&&(t.cardHolderFirstName="",t.cardHolderLastName=""),a("passengerDetails",JSON.stringify(t),.5));rt();n("#cardHolderFirstName").change();n("#cardHolderLastName").change()});e=function(){n(this).attr("aria-expanded",!0);n("#storedCardDiv").hide();n(".new-card").show().attr("aria-hidden",!1);n(".primary-card-holder-select,.stored-card-data-hidden").show();rt();it();n(".confirmDelete").find(".notification-box").addClass("hidden");n("#cardSelectArea").removeClass("hidden")};n(".new-card-btn").click(e);n("#btnUpdateStoredCard").click(e);n(".stored-card-btn").click(function(){n(".new-card-btn").attr("aria-expanded",!1);n("#storedCardDiv").show();n(".new-card").hide().attr("aria-hidden",!0);n(".primary-card-holder-select, .card-holder-inputs,.stored-card-data-hidden").hide();it()});n(".rr-signup-expand-btn").click(function(){lt(n(this))});n(".rr-cancel").click(function(){lt(n(this))});n("#cardCountry").on("selectmenuchange",i);n("#cardHolderAddress").on("change",i);n("#cardHolderAddress2").on("change",i);n("#cardHolderZip").on("change",i);n("#cardHolderCity").on("change",i);n("#cardHolderState").on("selectmenuchange",i);n("#intRegion").on("change",i);n("#cardHolderPhone").on("change",i);n(".first-name").on("change",t);n(".last-name").on("change",t);n(".road-rewards").on("change",t);n(".sp-needs-options").on("selectmenuchange",t);n("#cardHolderFirstName").on("change",t);n("#cardHolderLastName").on("change",t);n("#cardHolderEmail").on("change",t);n("#ticket-type-eticket").on("change",t);n("#ticket-type-print").on("change",t);n("#ticket-type-collect").on("change",t);n("#termsAndConditions").on("change",t);n("#optInEmail").on("change",t);n("#outsideUSandCanada").on("change",t);n("#cardEXP").on("keyup",y);n("#payment-type-credit").change(function(){n(".payment-page").addClass("card-payment");n(".payment-page").removeClass("cash-payment");u.ETicketEligible?n("#ticket-type-eticket").iCheck("check"):n("#ticket-type-print").iCheck("check");n("#primary-card-holder").val()==="other"&&rt()});n("#payment-type-cash").change(function(){n(".payment-page").addClass("cash-payment");n(".payment-page").removeClass("card-payment");n("#ticket-type-collect").iCheck("check");u.RemoveFee("CardholderNotTraveling");at()});n("#outsideUSandCanada").on("change",function(){var t=n("#cashPhone");n("#outsideUSandCanada").prop("checked")?(t.attr("data-rule-foreignphone","OTHER"),t.attr("data-msgfor-foreignphone",t.attr("data-phoneforeign-msg"))):(t.attr("data-rule-foreignphone",o),t.attr("data-msgfor-foreignphone",t.attr("data-msg-phoneus")))});p=function(t){var r=function(n){ii(n);at()},u=function(){n("#willCallOptionAvailable").hide();n("#willCallOptionUnavailable").show();n("#ticket-type-print").iCheck("check");n("#payWithCashAvailable").hide();n("#payWithCashUnavailable").show();n("#payment-type-credit").iCheck("check")},i=f.PriceConfirmationParameters;i.ticketingMethod=t.target.id==="ticket-type-print"?"PrintAtHome":"WillCall";PriceRepo.GetConfirmation(r,u,i,!1)};n("#ticket-type-print").change(function(){n(".pick-up-only").removeClass("active");n(".ticket-only").addClass("active");c(u.IsLocationOpenAtDeparture,u.ClosedLocationHours)});n("#ticket-type-eticket").change(function(){n(".pick-up-only").removeClass("active");n(".ticket-only").addClass("active");c(u.IsLocationOpenAtDeparture,u.ClosedLocationHours)});n("#ticket-type-collect").change(function(){n(".pick-up-only").addClass("active");n(".ticket-only").removeClass("active");c(u.IsLocationOpenAtDeparture,u.ClosedLocationHours)});var c=function(t,i){var e=n("#ticket-type-collect")[0].checked,r,u,f;if(t!=undefined&&!t)if(n("#locationClosedWarning").hasClass("hide")&&e){if(r="",i!=undefined&&(r+=i[0].Open+" to "+i[0].Close,i.length>1)){for(u=1;u<i.length-1;u++)r+=", "+i[u].Open+" to "+i[u].Close;r+=" and "+i[i.length-1].Open+" to "+i[i.length-1].Close}f={};f.WillCallStationHours=r;Helpers.BindAndShow("locationClosedWarning",f);n("#locationClosedWarning").removeClass("hide");n("#willCallOption").addClass("active")}else e||(n("#locationClosedWarning").addClass("hide"),n("#willCallOption").removeClass("active"))},w=function(){function t(n,t,i){i&&t&&t.length>i&&(t=t.substring(0,i));(n.val()===""||n.val()===n.attr("placeholder"))&&n.val(t);n.data("rrDefault",t)}Cookies.remove("passengerDetails");var i=n(".row.passenger .first-name").first(),r=n(".row.passenger .last-name").first(),u=n(".row.passenger .road-rewards").first();t(i,roadRewardsUser.firstName,25);t(r,roadRewardsUser.lastName,25);t(u,roadRewardsUser.memberId);s()},b=function(t){function i(){var i=n(".row.passenger .phone").first(),r=n(".row.passenger .email").first(),t;l(i,roadRewardsUser.telephoneNumber);l(r,roadRewardsUser.email);t=n(".details-summary");t.find(".first-name").html(roadRewardsUser.firstName);t.find(".last-name").html(roadRewardsUser.lastName);t.find(".contact-number").html(roadRewardsUser.telephoneNumber);t.find(".email").html(roadRewardsUser.email)}function r(){n(".edit-details").on("click",function(t){t.preventDefault();n(this).attr("aria-expanded",!0);ct();n(window).trigger("resize")});n("#passenger-details input#specialNeeds").change(function(){ct()})}t?(i(),r(),n("body").addClass("oneClick"),n(".menu-lang").removeClass("menu-lang-open")):n(".payment-options").removeClass("hidden")};b(h);r=Cookies.getJSON("passengerDetails");r!==undefined&&r!==null?(nt=!0,yi(r)):roadRewardsUser!==null&&w()},ai=function(){vt(n(this))},ei=function(){function o(){i=null;t="Unknown";r>0&&(t=Ecom.CreditCards.CardTypeIdentifier.getCardTypeFromNumber(f));u=t.toLowerCase()+".png";t==="Unknown"&&(t="");e(u,t)}var i,s=0,f,r,t="",u,e=function(t,i){if(gt!=i){var f="/Content/Images/icons/payments/"+t,r=n(".card-detection"),e=n(".cc-number-callback"),u=n(".cc-icon");r.hasClass("hidden")||(r.addClass("hidden"),r.find("p").addClass("hidden").find("span.type").addClass("hidden"));i?(u.length?u.attr("src",f):n('<img class="cardIcon cc-icon"/>').insertBefore("input#cardNumber").attr("src",f).attr("alt",i),r.find(".detected").removeClass("hidden").find("."+i).removeClass("hidden"),e.html(n("#cardNumber").val()),r.removeClass("hidden")):u.remove();n("#cardType").val(i);gt=i}};n("#cardNumber").on("input",function(){n(this).val(function(n,t){return t.replace(/[^0-9]/g,"")});f=n(this).val().replace(/\s+/g,"");r=f.length;i&&clearTimeout(i);r<13?(t="",u="Unknown.png",e(u,t)):r>=13&&(i=setTimeout(o,s))}).on("blur",function(){o()})},pi=function(){var u,t,i;n("#ff-payment").length&&(n.validator.addMethod("specialNeedSelected",function(t,i){var r=!0;return i.checked&&(r=!1,n(".sp-needs-options").each(function(){n(this).val()!==""&&(r=!0)})),r}),n.validator.addMethod("IsSpecialNeedsValid",function(t,i){var r=!1;return i.checked?r=!0:y?s>e?(n.validator.messages.IsSpecialNeedsValid=n(".whchair-spaces-info .more-than").html(),ut()):s<e&&(n.validator.messages.IsSpecialNeedsValid=n(".whchair-spaces-info .less-than").html(),ut()):n.validator.messages.IsSpecialNeedsValid=n(".wheelchair-not-valid").html(),r}),n.validator.addMethod("unexpiredCard",function(t,i){var r=!1,u=n(i).find("option:selected"),f;return u&&(f=u.attr("data-card-expired"),r=f==="false"),r}),u=n("#ff-payment").validate({ignore:":not(.card-payment #cardHolderState, input:visible, textarea:visible, .stored-card-data #storedCard, #SpecialNeedsValid), .ignore",debug:!1,onfocusout:!1,focusInvalid:!0,rules:{SpecialNeedsValid:{IsSpecialNeedsValid:!0},cardHolderState:{required:{depends:function(){return!n("#cardHolderState").parent().hasClass("hide")}}},cardHolderZip:{zip:{depends:function(){return n("#cardCountry").val()===o}},cdnPostal:{depends:function(){return n("#cardCountry").val()===l}}},cardNumber:{creditcardtypes:function(){return n("#cardType").val()}},cardCCV:{minlength:function(){return n("#cardType").val()==="AmericanExpress"?4:3},maxlength:function(){return n("#cardType").val()==="AmericanExpress"?4:3}},storedCard:{unexpiredCard:{depends:function(){return n("#storedCardDiv").is(":visible")}}}},highlight:function(t){n(t).is("select")&&n(t).parent("div").addClass("error");n(t).attr("class").indexOf("icheck_minimal")>-1?n(t).parent().parent().addClass("error"):n(t).parent("div").addClass("error");n(".selectmenu").on("selectmenuchange",function(){n(t).is(".sp-needs-options")?n(this).parents("form").validate().element(n("#SpecialNeedsValid")):n(this).parents("form").validate().element(n(this))})},unhighlight:function(t){n(t).attr("class").indexOf("icheck_minimal")>-1?n(t).parent().parent().removeClass("error"):n(t).parent("div").removeClass("error");n(t).removeAttr("aria-label").attr("aria-labelledby",n(t).attr("id")+"-label")},errorPlacement:function(t,i){var u,r;n("#"+t.attr("id")).remove();t.prepend('<span class="accessibility_hidden">Error. <\/span>');t.addClass("error-alert real");i.parent().find(".error-alert").length&&i.parent().find(".error-alert").remove();n(i).is("#SpecialNeedsValid")&&t.addClass("static-error");n(i).is("#SpecialNeedsValid")?n(".wchair-error-placement").html("").promise().done(function(){t.prependTo(".wchair-error-placement").attr("tabindex","0").removeAttr("role")}):t.prependTo(i.parent());n(i).removeAttr("aria-labelledby");n(i).is("select")?(i=n(i).next(".ui-selectmenu-button"),n(i).attr("aria-labelledby",n(i).attr("id")+"-label "+t.attr("id"))):n(i).is("input[type='checkbox']")?i.attr("aria-label",n(t).text()):(u=n('label[for="'+n(i).attr("id")+'"]').html(),n(i).attr("aria-label",u+". "+n(t).text()));i.attr("data-aria-error-label")&&(r=t.clone(),r.attr("class","accessibility_hidden"),r.attr("id",r.attr("id")+"-aria-error"),r.html(i.attr("data-aria-error-label")),r.remove(),r.prependTo(i.parent()),i.attr("aria-labelledby",r.attr("id")));i.blur(function(){n(this).parent().find(".error-alert").removeClass("active")});i.focus(function(){n(this).parent().find(".error-alert").addClass("active")})},invalidHandler:function(t,i){var f=i.numberOfInvalids();if(f){var r=i.errorList[0].element.id,e=n("#"+r).siblings(".error")?25+n("#"+r).siblings(".error").outerHeight():0,u=n("#"+r).offset().top-n(".sticky-payment").outerHeight()-e;n(i.errorList[0].element).is(".selectpicker")&&(u=n(i.errorList[0].element).parents(".form-group").offset().top-n(".sticky-payment").outerHeight()-20);setTimeout(function(){n(i.errorList[0].element).is("#SpecialNeedsValid")?(n("html, body").animate({scrollTop:n("#wchair-error-placement").offset().top},100),n(".wchair-error-placement label").attr("tabindex","0").focus()):n(i.errorList[0].element).focus();n(window).scrollTop(u)},750)}n("#cardType").change(function(){n("#cardCCV,#cardNumber").valid()});n(".form-control").on("change",function(){n(this).valid()});n("#termsAndConditions").change(function(){n(this).valid()})},showErrors:function(){this.defaultShowErrors();n(".error-alert").each(function(){n(this).removeAttr("style");n(this).closest(".form-group").find("input").is(":focus")&&n(this).addClass("active")})}}),roadRewardsUser&&(t=[],n("input.form-control.road-rewards").each(function(){t.push(n(this).val())}),i={UserRRID:roadRewardsUser.memberId,usingReward:r.discountCode?!0:!1,RRIDs:t},n("input.form-control.road-rewards").first().rules("add",{roadRewardsUser:i})))},wi=function(){var t=n(".card-expiry").attr("placeholder"),i=n(".card-expiry").attr("data-mask")||t;n(".card-expiry").focus(function(){n(this).attr("placeholder",i)});n(".card-expiry").blur(function(){n(this).attr("placeholder",t)});n(".phone").each(function(){var t=n(this).attr("placeholder");n(this).blur(function(){n(this).attr("placeholder",t)})})},oi=function(){var o=n("#passenger-details input"),i=f.OutgoingFareType==="Economy"&&(!f.ReturnFareType||f.ReturnFareType==="Economy"),e=n("input[name=ticket-type]:checked").val(),t;if(u.ETicketEligible?n("#MobileETicketOption").show():(n("#MobileETicketOption").parent().detach(),n("#PrintAtHomeOption").show()),e||(u.ETicketEligible?n("#ticket-type-eticket").iCheck("check"):n("#ticket-type-print").iCheck("check")),t=ConfigurationSettings.EnablePod?r.wheelchairs:r.adultWheelchairs+r.childWheelchairs+r.seniorWheelchairs,u.IsPayWithCashOptionAvailable&&i&&!roadRewardsUser&&bi()&&!t){n("#payWithCashAvailable").show();n("#payWithCashUnavailable").hide();n(".sp-needs-options").on("selectmenuchange",function(){var t=yt(k,"WHEELCHAIR");t>0?(n("#payWithCashAvailable").hide(),n("#payWithCashUnavailable").show(),n("#payment-type-credit").iCheck("check")):(n("#payWithCashAvailable").show(),n("#payWithCashUnavailable").hide())});n("#payment-type-credit").parent().show()}else n("#payWithCashAvailable").hide(),n("#payWithCashUnavailable").show();u.IsWillCallDeliveryAvailable?(n("#willCallOptionAvailable").show(),n("#willCallOptionUnavailable").hide(),n("#ticket-type-print").parent().show()):(n("#willCallOptionAvailable").hide(),n("#willCallOptionUnavailable").show());u.ETicketEligible&&u.ETicketOnly&&(n("#PrintAtHomeOption").hide(),n("#willCallOption").hide(),n("#payWithCashAvailable").hide(),n("#payWithCashUnavailable").show())},bi=function(){var n=typeof ssoAgent!="undefined";return ConfigurationSettings.EnableCallCenterUserPayWithCash&&n||!n},ut=function(){function i(t){n(t).parent(".form-group").addClass("error")}function t(t){n(t).parent(".form-group").removeClass("error")}n(".sp-needs-options").each(function(){y?p&&(s!=e?s>e?n(this).val()=="WHEELCHAIR"?i(n(this)):t(n(this)):s<e&&(n(this).val()==""?i(n(this)):t(n(this))):t(n(this))):n(this).val()=="WHEELCHAIR"?i(n(this)):t(n(this))})},ki=function(){var u=r.GetTotalPassengers(),t,i;e=ConfigurationSettings.EnablePod?r.wheelchairs:r.adultWheelchairs+r.childWheelchairs+r.seniorWheelchairs;t=function(){n("select.sp-needs-options").each(function(){Accessibility.initSelect(n(this))});h!=!0&&n("select.sp-needs-options").each(function(){n(this).val("");Accessibility.initSelect(n(this))});oi();n(".sp-needs-options").on("selectmenuchange",function(){kt();d.passengerDetailsChanged(tt());p&&(n("#SpecialNeedsValid").valid()?n("#wchair-error-placement").addClass("hidden"):n("#wchair-error-placement").removeClass("hidden"));bt();g(w,c)})};i=function(){r.GetTotalPassengers()==e&&n(".sp-needs-options").each(function(){n(this).val("WHEELCHAIR");n(this).find("option:not(:selected)").prop("disabled",!0);Accessibility.refreshSelect(n(this))})};t();i();kt()},di=function(){function s(){var t=n("#passenger-details .passenger-first"),i=t.find("input").serialize().toLowerCase();t.on("change input",function(){t.find("input").serialize().toLowerCase()===i?t.find(".someone-else-text").removeClass("active"):t.find(".someone-else-text").addClass("active")})}var t=function(t){var y,i;if(ii(t),f=Cookies.getJSON("scheduleData"),!u.ETicketEligible&&f.ETicketOnly)Cookies.remove("scheduleData"),window.location.assign(n("#NonETicketReturnErrorLink").attr("href"));else{var p=function(){function i(n,t,i,r){var u,o,s,h,c;if(i>0){for(u={Title:t,Tooltip:passengerTypeLabels[t].Description,Total:i,Wheelchair:parseInt(r),Passengers:[]},o=0;o<i;o++)f++,s=t,h=t,r>0&&(h+="-Wheelchair",s="Wheelchair"),c={Index:f,HasWheelchair:Boolean(r>0),Fare:st(s,e),Type:h},r--,u.Passengers.push(c);n.push(u)}}var e=n.extend(!0,{},u),f=0,t=[];return i(t,"Adult",r.adults,r.adultWheelchairs),i(t,"Senior",r.seniors,r.seniorWheelchairs),i(t,"Child",r.children,r.childWheelchairs),t},s=p(),a=0,v=!0;if(s.length>1&&s.forEach(function(n){n.Wheelchair>0&&a++}),a>1&&(v=!1),s.ShowIndividualPrice=v,ConfigurationSettings.EnablePod?(e=r.wheelchairs,s.SpecialNeeds=specialNeeds):(e=r.adultWheelchairs+r.childWheelchairs+r.seniorWheelchairs,s.SpecialNeeds=_.filter(specialNeeds,function(n){return n.Key!=="WHEELCHAIR"})),Helpers.BindAndShow("passenger-details",s),si(),handleTooltips(),ki(),bt(),y=function(){var s,r,u,t,i,f,e,c;if(roadRewardsUser!==null){if(s={cardHolderAddress:roadRewardsUser.address1,cardHolderAddress2:roadRewardsUser.address2,cardHolderCity:roadRewardsUser.city,cardHolderState:pt(roadRewardsUser.state),cardHolderZip:roadRewardsUser.zipCode,cardHolderPhone:roadRewardsUser.telephoneNumber,cardHolderEmail:roadRewardsUser.email,cashPhone:roadRewardsUser.telephoneNumber,cashEmail:roadRewardsUser.email,cardCountry:roadRewardsUser.Country,intRegion:roadRewardsUser.state==ot?"":roadRewardsUser.state},roadRewardsUser.Country&&window.EUCountries.indexOf(roadRewardsUser.Country)>=0?(n("#optInArea").show(),roadRewardsUser.optInEmail=="Y"&&n("#optInEmail").prop("checked",!0)):n("#optInArea").hide(),roadRewardsUser.Country==l&&(s.cardHolderState=pt(roadRewardsUser.state,roadRewardsUser.Country),statesByCountry[roadRewardsUser.Country])){for(r=statesByCountry[roadRewardsUser.Country],n("#cardHolderZipPlaceholder").html(r.ZipLabel),n("#cardHolderZip-label").html(r.ZipLabel),n("#cardHolderState").parent().removeClass("hide"),u=n("#cardHolderState")[0];u.options.length>1;)u.remove(u.options.length-1);dt(u,r.List);n("#cardHolderState .label").text(r.stateLabel);Accessibility.refreshSelect(n("#cardHolderState"));n("#intRegion").parent().addClass("hide")}n.each(s,function(t,i){n("#"+t).val(i)});n("#cardCountry").val()||n("#cardCountry").val(o);Accessibility.refreshSelect(n(".selectmenu"));Accessibility.refreshSelect(n("#cardCountry"));roadRewardsUser.Country&&roadRewardsUser.Country!=o&&roadRewardsUser.Country!=l&&(n("#cardHolderZipPlaceholder").html("Postal Code"),n("#cardHolderZip-label").html("Postal Code"),n("#cardHolderState").parent().addClass("hide"),n("#intRegion").parent().removeClass("hide"));t=n("<form id='tempForm'><\/form>");t.append(n("#edit-passenger-fields").clone(!0));t.append(n("#addressFields").clone(!0));n("body").append(t);t.find("#edit-passenger-fields").removeClass("hidden");t.find("#cardHolderState").val(n("#cardHolderState").val());t.find("#cardCountry").val(n("#cardCountry").val());roadRewardsUser.Country&&t.find("#cardCountry").val(roadRewardsUser.Country);i={};roadRewardsUser.Country!=o&&roadRewardsUser.Country?ConfigurationSettings.NATPCountries.indexOf(roadRewardsUser.Country)>=0?(i.Rule="NATP",i.PhoneValidationMsgAttr="data-phoneforeign-msg"):(i.Rule="OTHER",i.PhoneValidationMsgAttr="data-phoneforeign-msg"):(i.Rule=o,i.PhoneValidationMsgAttr="data-msg-phoneus");f=n("#passenger-1-cardHolderPhone");e=n("#cardHolderPhone");t.find("#passenger-1-cardHolderPhone").attr("data-rule-foreignphone",i.Rule);f.attr("data-rule-foreignphone",i.Rule);f.attr("data-msgfor-foreignphone",f.attr(i.PhoneValidationMsgAttr));e.attr("data-rule-foreignphone",i.Rule);e.attr("data-msgfor-foreignphone",e.attr(i.PhoneValidationMsgAttr));t.find("#cardCountry").show();roadRewardsUser.Country==o||roadRewardsUser.Country==l?(t.find("#intRegion").parent().addClass("hide"),t.find("#cardHolderState").show()):(t.find("#cardHolderState").hide(),t.find("#cardHolderState").attr("disabled","disabled"),t.find("#cardHolderState").parent().addClass("hide"),t.find("#intRegion").show());n(".selectmenu").selectmenu("refresh");Accessibility.refreshSelect(n(".selectmenu"));c=!t.valid();t.remove();c?(n("#editAddress").hide(),h&&(ct(),n(window).trigger("resize"))):(n("#staticAddress > .cardHolderAddress").html(roadRewardsUser.address1),n("#staticAddress > .cardHolderAddress2").html(roadRewardsUser.city+" "+(roadRewardsUser.state==ot?"":roadRewardsUser.state)+" "+roadRewardsUser.zipCode),n("#staticAddress > .country").html(countries[roadRewardsUser.Country]),nr())}},d.passengerDetailsChanged(tt()),ci(),i=Cookies.getJSON("passengerDetails"),i!==undefined&&i!==null&&i.isCardDetailUpdated?n("#editAddress").hide():y(),i!==undefined&&i!==null&&n("#cardHolderEmail").val(i.passengeremail),oi(),li(),t.FareSubtotalChanged){var w=t.FareSubtotal>t.OriginalFareSubtotal?"Increase":"Decrease",b=Math.abs(t.FareSubtotal-t.OriginalFareSubtotal)>=ConfigurationSettings.MajorPriceChangeThreshold?"Major":"Minor",c=priceChangeMessages[b+w];c=c.replace("{0}","$"+t.OriginalFareSubtotal.toFixed(2));c=c.replace("{1}","$"+t.FareSubtotal.toFixed(2));n("tr td.ss_warning p").html(c);n("tr td.ss_warning p").removeClass("hidden")}else n("tr.ss_warning").addClass("hidden");n(".float-label-control input").change();roadRewardsUser&&(n("#passenger-1-rr-id").val(roadRewardsUser.memberId),n("#passenger-1-rr-id").change());nt=!1;n("#passenger-1-firstname").on("change",ht);n("#passenger-1-lastname").on("change",ht);$gh(".loader-overlay").hide(0,function(){$gh(".payment-page").removeClass("ghidden")})}},i=function(n){window.location=ConfigurationSettings.GenericErrorUrl+"?errorCode="+encodeURIComponent(n.Code)+"&errorUrl="+encodeURIComponent(ConfigurationSettings.PaymentErrorUrl)};PriceRepo.GetConfirmation(t,i,null,!0);roadRewardsUser!==null&&s()};n("#cardHolderZip").change(function(){var t,i;ConfigurationSettings.UseZipCodeLookupService&&(t=n("#cardHolderZip").val(),t.length>=5&&(t.length==9&&t.indexOf("-")==-1&&(t=t.replace(/(\d{5})(\d{4})/,"$1-$2")),i=/^[0-9]{5}(?:-[0-9]{4})?$/.test(t),i&&parseInt(t,10)!==0&&(Accessibility.announceStatusUpdate("Searching for city.","assertive"),n("#zipCodeLoading").removeClass("ghidden"),n.ajax({url:"/form/GetCityStateByZip",data:{zipCode:t},dataType:"json",type:"GET",contentType:"application/json",timeout:ConfigurationSettings.ZipCodeClientRequestTimeout,success:function(t){var i=JSON.parse(t);i.city.indexOf(n("#cardHolderCity").val()==0)&&(n("#cardHolderCity").val(i.city).prev(".control-label").removeClass("placeholder-label").addClass("accessibility_hidden"),n("#cardHolderCity").change(),setTimeout(function(){Accessibility.announceStatusUpdate("City has been pre-populated with "+i.city+" based on your zip code.")},ConfigurationSettings.ZipCodeFieldDisableTime));n("#cardHolderState").val(pt(i.state));Accessibility.refreshSelect(n("#cardHolderState"));n("#cardHolderCity").valid();n("#cardHolderState").valid();n("#zipCodeLoading").addClass("ghidden")},error:function(){n("#zipCodeLoading").addClass("ghidden")}}))))});var nr=function(){n("#addressFields").hide().find("input").addClass("ignore");n("#editAddressBtn").click(function(){n(this).attr("aria-expanded","true").attr("aria-labelledby","");n("#addressFields").show().find("input").removeClass("ignore");n("#editAddress").hide();n(window).trigger("resize")})},si=function(){n(document).ready(function(){n(".float-label-control").floatLabels();n("#cardEXP").on("focus",function(t){var i=n(t.target);i.val()==""&&n("#cardEXPPlaceholder").addClass("hidden")})})},wt=function(t){n("#termsAndConditionsArea").find(".lbl").not("."+t).hide();n("#termsAndConditionsArea").find("."+t).show()},tr=function(){var t=!1;return n("select.sp-needs-options").each(function(){n(this).val()!=""&&(t=!0)}),t},bt=function(){var t=tr();et=roadRewardsUser&&roadRewardsUser.agreedToTncVersion&&ConfigurationSettings.TNCVersion===parseInt(roadRewardsUser.agreedToTncVersion);et?(n(".allTerms").remove(),n(".TermsAccepted").show(),t?(n("#termsAndConditionsArea").show(),wt("specialNeedsOnly")):n("#termsAndConditionsArea").hide()):(n(".TermsAccepted").hide(),t?wt("allTerms"):wt("termsWithoutSpecialNeedsTerms"))},kt=function(){k=[];n("select.sp-needs-options").each(function(){k.push(this.value)});s=yt(k,"WHEELCHAIR");ni=yt(k,"STOW-WHEELCHAIR");y=e>0?!0:!1;y?y&&(n(".whcair-num-selected").html(e),s!=e?(p||(n(".whchair-spaces-info").removeClass("hidden"),s>e?(n(".less-than").addClass("hidden"),n(".more-than").removeClass("hidden")):(n(".less-than").removeClass("hidden"),n(".more-than").addClass("hidden"))),b=!1):s==e&&(n(".whchair-spaces-info").addClass("hidden"),b=!0)):s?(p||(n(".whchair-spaces-info").removeClass("hidden").addClass("error"),n(".wheelchair-not-valid").removeClass("hidden")),b=!1):(p||(n(".whchair-spaces-info").addClass("hidden").removeClass("error"),n(".wheelchair-not-valid").addClass("hidden")),b=!0);ut();b?n("#SpecialNeedsValid").prop("checked",!0):n("#SpecialNeedsValid").prop("checked",!1);ni?n(".stowed-wheelchair-info").removeClass("hidden"):n(".stowed-wheelchair-info").addClass("hidden")},ir=function(){var t=n(".reauthenticate"),s=t.find(".forgot-password"),i=n("#reauthenticate-fp-form"),r=i.find(".close"),l=t.find(".rr-confirm"),a=t.find(".rr-remind"),u=t.find("#emailError"),f=n("#scforgotyouremail"),h=Helpers.GetQueryString(),e,o;h.loginfailurereason&&(lt(n(".rr-signup-expand-btn")),n("#reconfirm-incorrectPassword").removeClass("hidden"));s.on("click",function(r){r.preventDefault();t.addClass("forgot-password");i.attr("aria-hidden",!1);n(this).attr("aria-expanded",!0);f.val()||f.val(roadRewardsUser.email)});r.on("click",function(){t.removeClass("forgot-password");i.attr("aria-hidden",!0);u.addClass("hidden");n(this).attr("aria-expanded",!1)});e=function(t){if(t){var r=n("#reconfirm-password").val(),i=n("form.payment-signinup-form"),u=i.attr("action");i.attr("action",u+"#cardDetails");i.find("#paymentemailorid").val(roadRewardsUser.email);i.find("#password").val(r);ConfigurationSettings.AmiaServiceEnabled?loginValidationRequest("ff-rr-login",roadRewardsUser.email):i.submit()}else n("#reconfirm-incorrectPassword").addClass("hidden")};o=function(t){if(t){var i=function(){r.click();n(".intro-text").addClass("hidden");n("#reconfirm-incorrectPassword").addClass("hidden");n("#success-alert").removeClass("hidden").attr("tabindex","0").focus()},f=function(){u.removeClass("hidden")},e=n("#scforgotyouremail").val();FormForgotPassword.SendReminder(e,i,f)}};c.submit(function(n){var t=c.valid();i.is(":visible")?o(t):e(t);n.preventDefault()})};n("#ff-rr-login input[name=password]").keypress(function(t){var r=t.which,i,u;r==13&&(i=n("#ff-rr-login input[name=username]").val(),u=n("#ff-rr-login input[name=password]").val(),loginValidationRequest("ff-rr-login",i))});var rr=function(){var t=n("#payment-gr-login-btn");t.click(function(){var t=n("#payment-gr-login input[name=username]").val(),i=n("#payment-gr-login input[name=password]").val();loginValidationRequest("ff-rr-login",t)})},ur=function(){var i=window.loginFailureArea,t=window.loginFailureResultCode;if(i!=="payment"){n(".payment-signinup-form .login-error").removeClass("active");return}n.ajax({url:"/services/GetErrorMessage",data:{errorCode:t},dataType:"json",type:"GET",contentType:"application/json",success:function(i){t=="ValidEmailExists"||t=="LoginFailed"||t=="ValidEmailNotExists"?(n(".payment-signinup-form .login-error").text(i.errorMessage),n(".payment-signinup-form .login-error").addClass("active"),Accessibility.announceStatusUpdate(i.errorMessage,"assertive","alert")):n(".payment-signinup-form .login-error").removeClass("active")},error:function(){}});n(".payment-signinup-form .ff-rr-password,.payment-signinup-form .ff-rr-number").on("focus",function(){n(".payment-signinup-form .login-error").removeClass("active")})},fr=function(){n(window).bind("resize",function(){g(w,c)});g(w,c)},g=function(n,t){var i=n.offset();t.css({position:"absolute",top:i.top,left:i.left,width:n.width()});n.css("height",t.height())},er=function(){var i=moment().add(ConfigurationSettings.PaymentPageMaxTime,"m"),t=!1,r=function(i){var r=n("#payment-timeout"),e=n("#lc_chat_layout.lc-expanded").length>=1,u,f;(!t||i<=2)&&(u=Math.ceil(i),r.find(".time").html(u),f=e?"450":"50",r.removeClass("hidden").animate({bottom:f},1e3));r.find(".close").on("click",function(n){n.preventDefault();t=!0;r.animate({bottom:"-50%"},1e3,function(){r.addClass("hidden")})})},u=function(n){var u=i.diff(moment(),"m"),t=Math.min(u,n);t<=0?(SessionTracker.RedirectToTimeout(),Cookies.remove("passengerDetails")):t<=ConfigurationSettings.PaymentPageMinTime&&r(t)};SessionTracker.StartTracking(u)},or=function(){var i=n("#ghr-signin"),r=i.find(".sign-in-btn"),t=i.find("#ghr-signin-form"),u=t.find(".rr-cancel");r.unbind("click").bind("click",function(i){i.preventDefault();t.removeClass("hidden");n(this).addClass("hidden").attr("aria-expanded",!0);var r=n("#payment-gr-login input[name=username]").val()});u.unbind("click").bind("click",function(n){n.preventDefault();t.addClass("hidden");r.removeClass("hidden").attr("aria-expanded",!1)})},sr=function(){if(f){var t={upsellAmount:f.UpsellTotalAmount,tripType:f.ReturnFareType!==null?"round trip":"one way trip",showUpsell:f.ShowUpsell,fareType:f.OutgoingFareType,upsellFareType:f.OutgoingUpsellFareType};Helpers.BindAndShow("prompt-upsell",t);Helpers.BindAndShow("prompt-upsell-description",t)}n("#upsell-upgrade").on("click",function(){if(f){f.OutgoingFareType=f.OutgoingUpsellFareType;f.PriceConfirmationParameters.outboundFareKey=f.PriceConfirmationParameters.outboundUpsellFareKey;f.ReturnFareType=f.ReturnUpsellFareType;f.PriceConfirmationParameters.returnFareKey=f.PriceConfirmationParameters.returnUpsellFareKey;f.OutgoingUpsellFareType=null;f.PriceConfirmationParameters.outboundUpsellFareKey=null;f.ReturnUpsellFareType=null;f.PriceConfirmationParameters.returnUpsellFareKey=null;f.ShowUpsell=!1;Cookies.remove("scheduleData");Cookies.set("scheduleData",JSON.stringify(f));var n=Cookies.getJSON("passengerDetails");n!==undefined&&n!==null&&(n.isUpgraded=!0,a("passengerDetails",JSON.stringify(n),.5));window.location="payment"}})},hr=function(t,u){Accessibility.initSelect(n("#cardHolderState"));Accessibility.initSelect(n("#primary-card-holder"));Accessibility.initSelect(n("#cardCountry"));var e=function(){n("#logout-modal").dialog({autoOpen:!1,maxWidth:980,width:"auto",modal:!0,draggable:!1,resizable:!1,title:"",open:function(){n(".ui-dialog-titlebar").remove();n(".title").focus();n(window).width()<=768&&n("#logout-modal").parent().closest(".ui-dialog").css({left:"0px"})}});n("#logout-modal .close").on("click",function(){n("#logout-modal").dialog("close")}).on("keydown",function(t){var i=t.which;(i===13||i===32)&&n(this).click()});n("#logout-modal .cancel-logout").on("click",function(){n("#logout-modal").dialog("close")})},o=function(){n("#logout-modal").dialog("open")};e();n("#logoutNavigationBtn").unbind("click");n("#logoutNavigationBtn").on("click",function(n){n.preventDefault();o()});h=t;d=u;r=SearchRepo.GetCurrent();f=Cookies.getJSON("scheduleData");f||(window.location=ConfigurationSettings.SessionTimeoutRedirectUrl);ValidatorExtensions.init();wi();gi();vi();hi();di();sr();h||i.init();ConfigurationSettings.AmiaServiceEnabled?(rr(),or()):ur();ei();ir();er();fr();si()},dt=function(n,t){Object.keys(t).forEach(function(i){var r=document.createElement("option");r.text=t[i];r.value=i;n.options.add(r)})};return{init:hr,creditCardDetection:ei}}(jQuery,Ghound,RetailerMap);saveAs=saveAs||function(n){"use strict";if(typeof n!="undefined"&&(typeof navigator=="undefined"||!/MSIE [1-9]\./.test(navigator.userAgent))){var s=n.document,r=function(){return n.URL||n.webkitURL||n},i=s.createElementNS("http://www.w3.org/1999/xhtml","a"),h="download"in i,c=function(n){var t=new MouseEvent("click");n.dispatchEvent(t)},l=/constructor/i.test(n.HTMLElement),u=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(t){(n.setImmediate||n.setTimeout)(function(){throw t;},0)},v="application/octet-stream",y=4e4,f=function(n){var t=function(){typeof n=="string"?r().revokeObjectURL(n):n.remove()};setTimeout(t,y)},p=function(n,t,i){var r,u;for(t=[].concat(t),r=t.length;r--;)if(u=n["on"+t[r]],typeof u=="function")try{u.call(n,i||n)}catch(f){a(f)}},e=function(n){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob([String.fromCharCode(65279),n],{type:n.type}):n},o=function(t,o,s){s||(t=e(t));var a=this,k=t.type,b=k===v,y,w=function(){p(a,"writestart progress write writeend".split(" "))},d=function(){var i,e;if((u||b&&l)&&n.FileReader){i=new FileReader;i.onloadend=function(){var t=u?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;"),r=n.open(t,"_blank");r||(n.location.href=t);t=undefined;a.readyState=a.DONE;w()};i.readAsDataURL(t);a.readyState=a.INIT;return}y||(y=r().createObjectURL(t));b?n.location.href=y:(e=n.open(y,"_blank"),e||(n.location.href=y));a.readyState=a.DONE;w();f(y)};if(a.readyState=a.INIT,h){y=r().createObjectURL(t);setTimeout(function(){i.href=y;i.download=o;c(i);w();f(y);a.readyState=a.DONE});return}d()},t=o.prototype,w=function(n,t,i){return new o(n,t||n.name||"download",i)};return typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob?function(n,t,i){return t=t||n.name||"download",i||(n=e(n)),navigator.msSaveOrOpenBlob(n,t)}:(t.abort=function(){},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,w)}}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof module!="undefined"&&module.exports?module.exports.saveAs=saveAs:typeof define!="undefined"&&define!==null&&define.amd!==null&&define([],function(){return saveAs});Handlebars.registerHelper("numberInflection",Helpers.NumberInflection)